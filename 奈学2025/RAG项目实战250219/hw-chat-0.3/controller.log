2024-09-09 14:39:25 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:39:34 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:39:41 | INFO | controller | Ê≠£Âú®ÂêØÂä®ÊúçÂä°Ôºö
2024-09-09 14:39:41 | INFO | controller | Â¶ÇÈúÄÊü•Áúã ÊúçÂä°Êó•Âøó Êó•ÂøóÔºåËØ∑ÂâçÂæÄ /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:39:42 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:39:51 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m1288[0m]
2024-09-09 14:39:51 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:39:51 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:39:51 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20001[0m (Press CTRL+C to quit)
2024-09-09 14:39:51 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:39:51 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:39:51 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:39:58 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m1333[0m]
2024-09-09 14:39:58 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:39:58 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:39:58 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20000[0m (Press CTRL+C to quit)
2024-09-09 14:40:01 | INFO | controller | Register a new worker: http://127.0.0.1:21001
2024-09-09 14:40:01 | INFO | controller | Register done: http://127.0.0.1:21001, {'model_names': ['zhipu-api'], 'speed': 1, 'queue_length': 0}
2024-09-09 14:40:01 | INFO | stdout | [32mINFO[0m:     127.0.0.1:43534 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:40:01 | ERROR | stderr | Loading checkpoint shards:   0%|                                                                                              | 0/7 [00:00<?, ?it/s]
2024-09-09 14:40:01 | ERROR | stderr | Loading checkpoint shards:  14%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé                                                                         | 1/7 [00:00<00:02,  2.29it/s]
2024-09-09 14:40:02 | ERROR | stderr | Loading checkpoint shards:  29%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå                                                             | 2/7 [00:00<00:02,  2.33it/s]
2024-09-09 14:40:02 | ERROR | stderr | Loading checkpoint shards:  43%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä                                                 | 3/7 [00:01<00:01,  2.36it/s]
2024-09-09 14:40:03 | ERROR | stderr | Loading checkpoint shards:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè                                    | 4/7 [00:01<00:01,  2.41it/s]
2024-09-09 14:40:03 | ERROR | stderr | Loading checkpoint shards:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç                        | 5/7 [00:02<00:00,  2.36it/s]
2024-09-09 14:40:03 | ERROR | stderr | Loading checkpoint shards:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã            | 6/7 [00:02<00:00,  2.37it/s]
2024-09-09 14:40:04 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.57it/s]
2024-09-09 14:40:04 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.45it/s]
2024-09-09 14:40:04 | ERROR | stderr | 
2024-09-09 14:40:06 | INFO | controller | Register a new worker: http://127.0.0.1:20002
2024-09-09 14:40:06 | INFO | controller | Register done: http://127.0.0.1:20002, {'model_names': ['chatglm3-6b'], 'speed': 1, 'queue_length': 0}
2024-09-09 14:40:06 | INFO | stdout | [32mINFO[0m:     127.0.0.1:43544 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:40:06 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m1334[0m]
2024-09-09 14:40:06 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:40:06 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:40:06 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20002[0m (Press CTRL+C to quit)
2024-09-09 14:40:06 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:40:15 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m1478[0m]
2024-09-09 14:40:15 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:40:15 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:40:15 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:6006[0m (Press CTRL+C to quit)
2024-09-09 14:40:46 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:40:46 | INFO | stdout | [32mINFO[0m:     127.0.0.1:41580 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:40:51 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:40:51 | INFO | stdout | [32mINFO[0m:     127.0.0.1:57454 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:41:31 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:41:31 | INFO | stdout | [32mINFO[0m:     127.0.0.1:55734 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:41:36 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:41:36 | INFO | stdout | [32mINFO[0m:     127.0.0.1:55738 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:42:16 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:42:16 | INFO | stdout | [32mINFO[0m:     127.0.0.1:42862 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:42:21 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:42:21 | INFO | stdout | [32mINFO[0m:     127.0.0.1:54762 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:43:01 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:43:01 | INFO | stdout | [32mINFO[0m:     127.0.0.1:33600 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:43:06 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:43:06 | INFO | stdout | [32mINFO[0m:     127.0.0.1:33608 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:43:46 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:43:46 | INFO | stdout | [32mINFO[0m:     127.0.0.1:40836 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:43:51 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:43:51 | INFO | stdout | [32mINFO[0m:     127.0.0.1:34724 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:44:31 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:44:31 | INFO | stdout | [32mINFO[0m:     127.0.0.1:60578 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:44:36 | INFO | stdout | [32mINFO[0m:     127.0.0.1:33368 - "[1mPOST /api/chat/knowledge_base_chat HTTP/1.1[0m" [91m500 Internal Server Error[0m
2024-09-09 14:44:36 | ERROR | stderr | [31mERROR[0m:    Exception in ASGI application
2024-09-09 14:44:36 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:44:36 | ERROR | stderr |   File "asyncmy/connection.pyx", line 565, in asyncmy.connection.Connection.connect
2024-09-09 14:44:36 | ERROR | stderr |   File "asyncmy/connection.pyx", line 556, in asyncmy.connection.Connection.connect
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/asyncio/tasks.py", line 447, in wait_for
2024-09-09 14:44:36 | ERROR | stderr |     return fut.result()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/asyncio/streams.py", line 47, in open_connection
2024-09-09 14:44:36 | ERROR | stderr |     transport, _ = await loop.create_connection(
2024-09-09 14:44:36 | ERROR | stderr |   File "uvloop/loop.pyx", line 2042, in create_connection
2024-09-09 14:44:36 | ERROR | stderr | OSError: Multiple exceptions: [Errno 111] Connection refused, [Errno 99] Cannot assign requested address
2024-09-09 14:44:36 | ERROR | stderr | 
2024-09-09 14:44:36 | ERROR | stderr | The above exception was the direct cause of the following exception:
2024-09-09 14:44:36 | ERROR | stderr | 
2024-09-09 14:44:36 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
2024-09-09 14:44:36 | ERROR | stderr |     self._dbapi_connection = engine.raw_connection()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3302, in raw_connection
2024-09-09 14:44:36 | ERROR | stderr |     return self.pool.connect()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
2024-09-09 14:44:36 | ERROR | stderr |     return _ConnectionFairy._checkout(self)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
2024-09-09 14:44:36 | ERROR | stderr |     fairy = _ConnectionRecord.checkout(pool)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
2024-09-09 14:44:36 | ERROR | stderr |     rec = pool._do_get()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
2024-09-09 14:44:36 | ERROR | stderr |     with util.safe_reraise():
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
2024-09-09 14:44:36 | ERROR | stderr |     raise exc_value.with_traceback(exc_tb)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
2024-09-09 14:44:36 | ERROR | stderr |     return self._create_connection()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
2024-09-09 14:44:36 | ERROR | stderr |     return _ConnectionRecord(self)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
2024-09-09 14:44:36 | ERROR | stderr |     self.__connect()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
2024-09-09 14:44:36 | ERROR | stderr |     with util.safe_reraise():
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
2024-09-09 14:44:36 | ERROR | stderr |     raise exc_value.with_traceback(exc_tb)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
2024-09-09 14:44:36 | ERROR | stderr |     self.dbapi_connection = connection = pool._invoke_creator(self)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
2024-09-09 14:44:36 | ERROR | stderr |     return dialect.connect(*cargs, **cparams)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 621, in connect
2024-09-09 14:44:36 | ERROR | stderr |     return self.loaded_dbapi.connect(*cargs, **cparams)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/dialects/mysql/asyncmy.py", line 284, in connect
2024-09-09 14:44:36 | ERROR | stderr |     await_only(creator_fn(*arg, **kw)),
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
2024-09-09 14:44:36 | ERROR | stderr |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
2024-09-09 14:44:36 | ERROR | stderr |     value = await result
2024-09-09 14:44:36 | ERROR | stderr |   File "asyncmy/connection.pyx", line 1343, in _connect
2024-09-09 14:44:36 | ERROR | stderr |   File "asyncmy/connection.pyx", line 588, in connect
2024-09-09 14:44:36 | ERROR | stderr | asyncmy.errors.OperationalError: (2003, "Can't connect to MySQL server on 'localhost' (Multiple exceptions: [Errno 111] Connection refused, [Errno 99] Cannot assign requested address)")
2024-09-09 14:44:36 | ERROR | stderr | 
2024-09-09 14:44:36 | ERROR | stderr | The above exception was the direct cause of the following exception:
2024-09-09 14:44:36 | ERROR | stderr | 
2024-09-09 14:44:36 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 401, in run_asgi
2024-09-09 14:44:36 | ERROR | stderr |     result = await app(  # type: ignore[func-returns-value]
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 70, in __call__
2024-09-09 14:44:36 | ERROR | stderr |     return await self.app(scope, receive, send)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
2024-09-09 14:44:36 | ERROR | stderr |     await super().__call__(scope, receive, send)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/applications.py", line 123, in __call__
2024-09-09 14:44:36 | ERROR | stderr |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 186, in __call__
2024-09-09 14:44:36 | ERROR | stderr |     raise exc
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 164, in __call__
2024-09-09 14:44:36 | ERROR | stderr |     await self.app(scope, receive, _send)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/cors.py", line 85, in __call__
2024-09-09 14:44:36 | ERROR | stderr |     await self.app(scope, receive, send)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
2024-09-09 14:44:36 | ERROR | stderr |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:44:36 | ERROR | stderr |     raise exc
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:44:36 | ERROR | stderr |     await app(scope, receive, sender)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 756, in __call__
2024-09-09 14:44:36 | ERROR | stderr |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 776, in app
2024-09-09 14:44:36 | ERROR | stderr |     await route.handle(scope, receive, send)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 297, in handle
2024-09-09 14:44:36 | ERROR | stderr |     await self.app(scope, receive, send)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 77, in app
2024-09-09 14:44:36 | ERROR | stderr |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:44:36 | ERROR | stderr |     raise exc
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:44:36 | ERROR | stderr |     await app(scope, receive, sender)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 72, in app
2024-09-09 14:44:36 | ERROR | stderr |     response = await func(request)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/routing.py", line 278, in app
2024-09-09 14:44:36 | ERROR | stderr |     raw_response = await run_endpoint_function(
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
2024-09-09 14:44:36 | ERROR | stderr |     return await dependant.call(**values)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/chat/knowledge_base_chat.py", line 68, in knowledge_base_chat
2024-09-09 14:44:36 | ERROR | stderr |     kb = await KBServiceFactory.get_service_by_name(knowledge_base_name)  # default @ bge-large-zh-v1.5
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/knowledge_base/kb_service/base.py", line 366, in get_service_by_name
2024-09-09 14:44:36 | ERROR | stderr |     _, vs_type, embed_model = await load_kb_from_db(kb_name)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/db/session.py", line 22, in wrapper
2024-09-09 14:44:36 | ERROR | stderr |     return await f(session, *args, **kwargs)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/db/repository/knowledge_base_repository.py", line 48, in load_kb_from_db
2024-09-09 14:44:36 | ERROR | stderr |     result = await session.execute(stmt)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
2024-09-09 14:44:36 | ERROR | stderr |     result = await greenlet_spawn(
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
2024-09-09 14:44:36 | ERROR | stderr |     result = context.throw(*sys.exc_info())
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
2024-09-09 14:44:36 | ERROR | stderr |     return self._execute_internal(
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2237, in _execute_internal
2024-09-09 14:44:36 | ERROR | stderr |     conn = self._connection_for_bind(bind)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2106, in _connection_for_bind
2024-09-09 14:44:36 | ERROR | stderr |     return trans._connection_for_bind(engine, execution_options)
2024-09-09 14:44:36 | ERROR | stderr |   File "<string>", line 2, in _connection_for_bind
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
2024-09-09 14:44:36 | ERROR | stderr |     ret_value = fn(self, *arg, **kw)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1189, in _connection_for_bind
2024-09-09 14:44:36 | ERROR | stderr |     conn = bind.connect()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3278, in connect
2024-09-09 14:44:36 | ERROR | stderr |     return self._connection_cls(self)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 148, in __init__
2024-09-09 14:44:36 | ERROR | stderr |     Connection._handle_dbapi_exception_noconnection(
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2442, in _handle_dbapi_exception_noconnection
2024-09-09 14:44:36 | ERROR | stderr |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
2024-09-09 14:44:36 | ERROR | stderr |     self._dbapi_connection = engine.raw_connection()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3302, in raw_connection
2024-09-09 14:44:36 | ERROR | stderr |     return self.pool.connect()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
2024-09-09 14:44:36 | ERROR | stderr |     return _ConnectionFairy._checkout(self)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
2024-09-09 14:44:36 | ERROR | stderr |     fairy = _ConnectionRecord.checkout(pool)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
2024-09-09 14:44:36 | ERROR | stderr |     rec = pool._do_get()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
2024-09-09 14:44:36 | ERROR | stderr |     with util.safe_reraise():
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
2024-09-09 14:44:36 | ERROR | stderr |     raise exc_value.with_traceback(exc_tb)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
2024-09-09 14:44:36 | ERROR | stderr |     return self._create_connection()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
2024-09-09 14:44:36 | ERROR | stderr |     return _ConnectionRecord(self)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
2024-09-09 14:44:36 | ERROR | stderr |     self.__connect()
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
2024-09-09 14:44:36 | ERROR | stderr |     with util.safe_reraise():
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
2024-09-09 14:44:36 | ERROR | stderr |     raise exc_value.with_traceback(exc_tb)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
2024-09-09 14:44:36 | ERROR | stderr |     self.dbapi_connection = connection = pool._invoke_creator(self)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
2024-09-09 14:44:36 | ERROR | stderr |     return dialect.connect(*cargs, **cparams)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 621, in connect
2024-09-09 14:44:36 | ERROR | stderr |     return self.loaded_dbapi.connect(*cargs, **cparams)
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/dialects/mysql/asyncmy.py", line 284, in connect
2024-09-09 14:44:36 | ERROR | stderr |     await_only(creator_fn(*arg, **kw)),
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
2024-09-09 14:44:36 | ERROR | stderr |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2024-09-09 14:44:36 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
2024-09-09 14:44:36 | ERROR | stderr |     value = await result
2024-09-09 14:44:36 | ERROR | stderr |   File "asyncmy/connection.pyx", line 1343, in _connect
2024-09-09 14:44:36 | ERROR | stderr |   File "asyncmy/connection.pyx", line 588, in connect
2024-09-09 14:44:36 | ERROR | stderr | sqlalchemy.exc.OperationalError: (asyncmy.errors.OperationalError) (2003, "Can't connect to MySQL server on 'localhost' (Multiple exceptions: [Errno 111] Connection refused, [Errno 99] Cannot assign requested address)")
2024-09-09 14:44:36 | ERROR | stderr | (Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-09-09 14:44:36 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:44:36 | INFO | stdout | [32mINFO[0m:     127.0.0.1:60590 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:44:50 | INFO | stdout | [32mINFO[0m:     127.0.0.1:57664 - "[1mPOST /api/chat/knowledge_base_chat HTTP/1.1[0m" [91m500 Internal Server Error[0m
2024-09-09 14:44:50 | ERROR | stderr | [31mERROR[0m:    Exception in ASGI application
2024-09-09 14:44:50 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:44:50 | ERROR | stderr |   File "asyncmy/connection.pyx", line 565, in asyncmy.connection.Connection.connect
2024-09-09 14:44:50 | ERROR | stderr |   File "asyncmy/connection.pyx", line 556, in asyncmy.connection.Connection.connect
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/asyncio/tasks.py", line 447, in wait_for
2024-09-09 14:44:50 | ERROR | stderr |     return fut.result()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/asyncio/streams.py", line 47, in open_connection
2024-09-09 14:44:50 | ERROR | stderr |     transport, _ = await loop.create_connection(
2024-09-09 14:44:50 | ERROR | stderr |   File "uvloop/loop.pyx", line 2042, in create_connection
2024-09-09 14:44:50 | ERROR | stderr | OSError: Multiple exceptions: [Errno 111] Connection refused, [Errno 99] Cannot assign requested address
2024-09-09 14:44:50 | ERROR | stderr | 
2024-09-09 14:44:50 | ERROR | stderr | The above exception was the direct cause of the following exception:
2024-09-09 14:44:50 | ERROR | stderr | 
2024-09-09 14:44:50 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
2024-09-09 14:44:50 | ERROR | stderr |     self._dbapi_connection = engine.raw_connection()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3302, in raw_connection
2024-09-09 14:44:50 | ERROR | stderr |     return self.pool.connect()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
2024-09-09 14:44:50 | ERROR | stderr |     return _ConnectionFairy._checkout(self)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
2024-09-09 14:44:50 | ERROR | stderr |     fairy = _ConnectionRecord.checkout(pool)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
2024-09-09 14:44:50 | ERROR | stderr |     rec = pool._do_get()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
2024-09-09 14:44:50 | ERROR | stderr |     with util.safe_reraise():
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
2024-09-09 14:44:50 | ERROR | stderr |     raise exc_value.with_traceback(exc_tb)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
2024-09-09 14:44:50 | ERROR | stderr |     return self._create_connection()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
2024-09-09 14:44:50 | ERROR | stderr |     return _ConnectionRecord(self)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
2024-09-09 14:44:50 | ERROR | stderr |     self.__connect()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
2024-09-09 14:44:50 | ERROR | stderr |     with util.safe_reraise():
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
2024-09-09 14:44:50 | ERROR | stderr |     raise exc_value.with_traceback(exc_tb)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
2024-09-09 14:44:50 | ERROR | stderr |     self.dbapi_connection = connection = pool._invoke_creator(self)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
2024-09-09 14:44:50 | ERROR | stderr |     return dialect.connect(*cargs, **cparams)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 621, in connect
2024-09-09 14:44:50 | ERROR | stderr |     return self.loaded_dbapi.connect(*cargs, **cparams)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/dialects/mysql/asyncmy.py", line 284, in connect
2024-09-09 14:44:50 | ERROR | stderr |     await_only(creator_fn(*arg, **kw)),
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
2024-09-09 14:44:50 | ERROR | stderr |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
2024-09-09 14:44:50 | ERROR | stderr |     value = await result
2024-09-09 14:44:50 | ERROR | stderr |   File "asyncmy/connection.pyx", line 1343, in _connect
2024-09-09 14:44:50 | ERROR | stderr |   File "asyncmy/connection.pyx", line 588, in connect
2024-09-09 14:44:50 | ERROR | stderr | asyncmy.errors.OperationalError: (2003, "Can't connect to MySQL server on 'localhost' (Multiple exceptions: [Errno 111] Connection refused, [Errno 99] Cannot assign requested address)")
2024-09-09 14:44:50 | ERROR | stderr | 
2024-09-09 14:44:50 | ERROR | stderr | The above exception was the direct cause of the following exception:
2024-09-09 14:44:50 | ERROR | stderr | 
2024-09-09 14:44:50 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 401, in run_asgi
2024-09-09 14:44:50 | ERROR | stderr |     result = await app(  # type: ignore[func-returns-value]
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 70, in __call__
2024-09-09 14:44:50 | ERROR | stderr |     return await self.app(scope, receive, send)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
2024-09-09 14:44:50 | ERROR | stderr |     await super().__call__(scope, receive, send)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/applications.py", line 123, in __call__
2024-09-09 14:44:50 | ERROR | stderr |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 186, in __call__
2024-09-09 14:44:50 | ERROR | stderr |     raise exc
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 164, in __call__
2024-09-09 14:44:50 | ERROR | stderr |     await self.app(scope, receive, _send)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/cors.py", line 85, in __call__
2024-09-09 14:44:50 | ERROR | stderr |     await self.app(scope, receive, send)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
2024-09-09 14:44:50 | ERROR | stderr |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:44:50 | ERROR | stderr |     raise exc
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:44:50 | ERROR | stderr |     await app(scope, receive, sender)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 756, in __call__
2024-09-09 14:44:50 | ERROR | stderr |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 776, in app
2024-09-09 14:44:50 | ERROR | stderr |     await route.handle(scope, receive, send)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 297, in handle
2024-09-09 14:44:50 | ERROR | stderr |     await self.app(scope, receive, send)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 77, in app
2024-09-09 14:44:50 | ERROR | stderr |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:44:50 | ERROR | stderr |     raise exc
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:44:50 | ERROR | stderr |     await app(scope, receive, sender)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 72, in app
2024-09-09 14:44:50 | ERROR | stderr |     response = await func(request)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/routing.py", line 278, in app
2024-09-09 14:44:50 | ERROR | stderr |     raw_response = await run_endpoint_function(
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
2024-09-09 14:44:50 | ERROR | stderr |     return await dependant.call(**values)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/chat/knowledge_base_chat.py", line 68, in knowledge_base_chat
2024-09-09 14:44:50 | ERROR | stderr |     kb = await KBServiceFactory.get_service_by_name(knowledge_base_name)  # default @ bge-large-zh-v1.5
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/knowledge_base/kb_service/base.py", line 366, in get_service_by_name
2024-09-09 14:44:50 | ERROR | stderr |     _, vs_type, embed_model = await load_kb_from_db(kb_name)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/db/session.py", line 22, in wrapper
2024-09-09 14:44:50 | ERROR | stderr |     return await f(session, *args, **kwargs)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/db/repository/knowledge_base_repository.py", line 48, in load_kb_from_db
2024-09-09 14:44:50 | ERROR | stderr |     result = await session.execute(stmt)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
2024-09-09 14:44:50 | ERROR | stderr |     result = await greenlet_spawn(
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
2024-09-09 14:44:50 | ERROR | stderr |     result = context.throw(*sys.exc_info())
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
2024-09-09 14:44:50 | ERROR | stderr |     return self._execute_internal(
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2237, in _execute_internal
2024-09-09 14:44:50 | ERROR | stderr |     conn = self._connection_for_bind(bind)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2106, in _connection_for_bind
2024-09-09 14:44:50 | ERROR | stderr |     return trans._connection_for_bind(engine, execution_options)
2024-09-09 14:44:50 | ERROR | stderr |   File "<string>", line 2, in _connection_for_bind
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
2024-09-09 14:44:50 | ERROR | stderr |     ret_value = fn(self, *arg, **kw)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1189, in _connection_for_bind
2024-09-09 14:44:50 | ERROR | stderr |     conn = bind.connect()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3278, in connect
2024-09-09 14:44:50 | ERROR | stderr |     return self._connection_cls(self)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 148, in __init__
2024-09-09 14:44:50 | ERROR | stderr |     Connection._handle_dbapi_exception_noconnection(
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2442, in _handle_dbapi_exception_noconnection
2024-09-09 14:44:50 | ERROR | stderr |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
2024-09-09 14:44:50 | ERROR | stderr |     self._dbapi_connection = engine.raw_connection()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3302, in raw_connection
2024-09-09 14:44:50 | ERROR | stderr |     return self.pool.connect()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
2024-09-09 14:44:50 | ERROR | stderr |     return _ConnectionFairy._checkout(self)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
2024-09-09 14:44:50 | ERROR | stderr |     fairy = _ConnectionRecord.checkout(pool)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
2024-09-09 14:44:50 | ERROR | stderr |     rec = pool._do_get()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
2024-09-09 14:44:50 | ERROR | stderr |     with util.safe_reraise():
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
2024-09-09 14:44:50 | ERROR | stderr |     raise exc_value.with_traceback(exc_tb)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
2024-09-09 14:44:50 | ERROR | stderr |     return self._create_connection()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
2024-09-09 14:44:50 | ERROR | stderr |     return _ConnectionRecord(self)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
2024-09-09 14:44:50 | ERROR | stderr |     self.__connect()
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
2024-09-09 14:44:50 | ERROR | stderr |     with util.safe_reraise():
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
2024-09-09 14:44:50 | ERROR | stderr |     raise exc_value.with_traceback(exc_tb)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
2024-09-09 14:44:50 | ERROR | stderr |     self.dbapi_connection = connection = pool._invoke_creator(self)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
2024-09-09 14:44:50 | ERROR | stderr |     return dialect.connect(*cargs, **cparams)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 621, in connect
2024-09-09 14:44:50 | ERROR | stderr |     return self.loaded_dbapi.connect(*cargs, **cparams)
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/dialects/mysql/asyncmy.py", line 284, in connect
2024-09-09 14:44:50 | ERROR | stderr |     await_only(creator_fn(*arg, **kw)),
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
2024-09-09 14:44:50 | ERROR | stderr |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2024-09-09 14:44:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
2024-09-09 14:44:50 | ERROR | stderr |     value = await result
2024-09-09 14:44:50 | ERROR | stderr |   File "asyncmy/connection.pyx", line 1343, in _connect
2024-09-09 14:44:50 | ERROR | stderr |   File "asyncmy/connection.pyx", line 588, in connect
2024-09-09 14:44:50 | ERROR | stderr | sqlalchemy.exc.OperationalError: (asyncmy.errors.OperationalError) (2003, "Can't connect to MySQL server on 'localhost' (Multiple exceptions: [Errno 111] Connection refused, [Errno 99] Cannot assign requested address)")
2024-09-09 14:44:50 | ERROR | stderr | (Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-09-09 14:45:16 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:45:16 | INFO | stdout | [32mINFO[0m:     127.0.0.1:50304 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:45:21 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:45:21 | INFO | stdout | [32mINFO[0m:     127.0.0.1:55870 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:45:32 | WARNING | controller | Sending SIGKILL to {'zhipu-api': <Process name='api_worker - zhipu-api (1335)' pid=1335 parent=1187 started daemon>}
2024-09-09 14:45:32 | WARNING | controller | Sending SIGKILL to {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (1334)' pid=1334 parent=1187 started daemon>}
2024-09-09 14:45:32 | WARNING | controller | Sending SIGKILL to <Process name='controller (1288)' pid=1288 parent=1187 started daemon>
2024-09-09 14:45:32 | WARNING | controller | Sending SIGKILL to <Process name='openai_api (1333)' pid=1333 parent=1187 started daemon>
2024-09-09 14:45:32 | WARNING | controller | Sending SIGKILL to <Process name='API Server (1478)' pid=1478 parent=1187 started daemon>
2024-09-09 14:45:32 | INFO | controller | Process status: {'zhipu-api': <Process name='api_worker - zhipu-api (1335)' pid=1335 parent=1187 started daemon>}
2024-09-09 14:45:32 | INFO | controller | Process status: {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (1334)' pid=1334 parent=1187 started daemon>}
2024-09-09 14:45:32 | INFO | controller | Process status: <Process name='controller (1288)' pid=1288 parent=1187 started daemon>
2024-09-09 14:45:32 | INFO | controller | Process status: <Process name='openai_api (1333)' pid=1333 parent=1187 started daemon>
2024-09-09 14:45:32 | INFO | controller | Process status: <Process name='API Server (1478)' pid=1478 parent=1187 started daemon>
2024-09-09 14:45:32 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 584, in <module>
2024-09-09 14:45:32 | ERROR | stderr |     loop.run_until_complete(start_main_server())
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 495, in start_main_server
2024-09-09 14:45:32 | ERROR | stderr |     cmd = queue.get()
2024-09-09 14:45:32 | ERROR | stderr |   File "<string>", line 2, in get
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 818, in _callmethod
2024-09-09 14:45:32 | ERROR | stderr |     kind, result = conn.recv()
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 255, in recv
2024-09-09 14:45:32 | ERROR | stderr |     buf = self._recv_bytes()
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 419, in _recv_bytes
2024-09-09 14:45:32 | ERROR | stderr |     buf = self._recv(4)
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 384, in _recv
2024-09-09 14:45:32 | ERROR | stderr |     chunk = read(handle, remaining)
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 14:45:32 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 14:45:32 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 14:45:32 | ERROR | stderr | Exception ignored in atexit callback: <function _exit_function at 0x7f2c8237ab90>
2024-09-09 14:45:32 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 334, in _exit_function
2024-09-09 14:45:32 | ERROR | stderr |     _run_finalizers(0)
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 300, in _run_finalizers
2024-09-09 14:45:32 | ERROR | stderr |     finalizer()
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 224, in __call__
2024-09-09 14:45:32 | ERROR | stderr |     res = self._callback(*self._args, **self._kwargs)
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 674, in _finalize_manager
2024-09-09 14:45:32 | ERROR | stderr |     process.join(timeout=1.0)
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/process.py", line 149, in join
2024-09-09 14:45:32 | ERROR | stderr |     res = self._popen.wait(timeout)
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/popen_fork.py", line 40, in wait
2024-09-09 14:45:32 | ERROR | stderr |     if not wait([self.sentinel], timeout):
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 936, in wait
2024-09-09 14:45:32 | ERROR | stderr |     ready = selector.select(timeout)
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/selectors.py", line 416, in select
2024-09-09 14:45:32 | ERROR | stderr |     fd_event_list = self._selector.poll(timeout)
2024-09-09 14:45:32 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 14:45:32 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 14:45:32 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 14:45:37 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:45:46 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:45:53 | INFO | controller | Ê≠£Âú®ÂêØÂä®ÊúçÂä°Ôºö
2024-09-09 14:45:53 | INFO | controller | Â¶ÇÈúÄÊü•Áúã ÊúçÂä°Êó•Âøó Êó•ÂøóÔºåËØ∑ÂâçÂæÄ /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:45:54 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:46:00 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m1971[0m]
2024-09-09 14:46:00 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:46:00 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:46:00 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20001[0m (Press CTRL+C to quit)
2024-09-09 14:46:01 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:46:01 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:46:01 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:46:08 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m2016[0m]
2024-09-09 14:46:08 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:46:08 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:46:08 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20000[0m (Press CTRL+C to quit)
2024-09-09 14:46:08 | ERROR | stderr | Loading checkpoint shards:   0%|                                                                                              | 0/7 [00:00<?, ?it/s]
2024-09-09 14:46:09 | ERROR | stderr | Loading checkpoint shards:  14%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé                                                                         | 1/7 [00:00<00:02,  2.25it/s]
2024-09-09 14:46:09 | ERROR | stderr | Loading checkpoint shards:  29%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå                                                             | 2/7 [00:00<00:02,  2.26it/s]
2024-09-09 14:46:09 | ERROR | stderr | Loading checkpoint shards:  43%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä                                                 | 3/7 [00:01<00:01,  2.29it/s]
2024-09-09 14:46:10 | ERROR | stderr | Loading checkpoint shards:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè                                    | 4/7 [00:01<00:01,  2.23it/s]
2024-09-09 14:46:10 | INFO | controller | Register a new worker: http://127.0.0.1:21001
2024-09-09 14:46:10 | INFO | controller | Register done: http://127.0.0.1:21001, {'model_names': ['zhipu-api'], 'speed': 1, 'queue_length': 0}
2024-09-09 14:46:10 | INFO | stdout | [32mINFO[0m:     127.0.0.1:60546 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:46:10 | ERROR | stderr | Loading checkpoint shards:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç                        | 5/7 [00:02<00:00,  2.18it/s]
2024-09-09 14:46:11 | ERROR | stderr | Loading checkpoint shards:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã            | 6/7 [00:02<00:00,  2.27it/s]
2024-09-09 14:46:11 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.51it/s]
2024-09-09 14:46:11 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.35it/s]
2024-09-09 14:46:11 | ERROR | stderr | 
2024-09-09 14:46:13 | INFO | controller | Register a new worker: http://127.0.0.1:20002
2024-09-09 14:46:13 | INFO | controller | Register done: http://127.0.0.1:20002, {'model_names': ['chatglm3-6b'], 'speed': 1, 'queue_length': 0}
2024-09-09 14:46:13 | INFO | stdout | [32mINFO[0m:     127.0.0.1:60556 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:46:13 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m2017[0m]
2024-09-09 14:46:13 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:46:13 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:46:13 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20002[0m (Press CTRL+C to quit)
2024-09-09 14:46:13 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:46:20 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m2160[0m]
2024-09-09 14:46:20 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:46:20 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:46:20 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:6006[0m (Press CTRL+C to quit)
2024-09-09 14:46:55 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:46:55 | INFO | stdout | [32mINFO[0m:     127.0.0.1:32900 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:46:58 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:46:58 | INFO | stdout | [32mINFO[0m:     127.0.0.1:32916 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:47:40 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:47:40 | INFO | stdout | [32mINFO[0m:     127.0.0.1:45172 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:47:43 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:47:43 | INFO | stdout | [32mINFO[0m:     127.0.0.1:45176 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,649 INFO sqlalchemy.engine.Engine SELECT DATABASE()
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,650 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,652 INFO sqlalchemy.engine.Engine SELECT @@sql_mode
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,652 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,653 INFO sqlalchemy.engine.Engine SELECT @@lower_case_table_names
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,653 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,655 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,692 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 14:47:49 | INFO | stdout | FROM knowledge_base
2024-09-09 14:47:49 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,693 INFO sqlalchemy.engine.Engine [generated in 0.00098s] ('private',)
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,713 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:47:49 | INFO | stdout | [32mINFO[0m:     127.0.0.1:52958 - "[1mPOST /api/chat/knowledge_base_chat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,732 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,736 INFO sqlalchemy.engine.Engine SELECT conversation.id AS conversation_id, conversation.user_id AS conversation_user_id, conversation.name AS conversation_name, conversation.chat_type AS conversation_chat_type, conversation.create_time AS conversation_create_time
2024-09-09 14:47:49 | INFO | stdout | FROM conversation
2024-09-09 14:47:49 | INFO | stdout | WHERE conversation.id = %s
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,737 INFO sqlalchemy.engine.Engine [generated in 0.00084s] ('84d11b49-848a-4a5c-894c-92e16e2e29d7',)
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,745 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,747 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,751 INFO sqlalchemy.engine.Engine INSERT INTO message (id, conversation_id, chat_type, query, response, meta_data, feedback_score, feedback_reason, create_time) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, now())
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,751 INFO sqlalchemy.engine.Engine [generated in 0.00083s] ('96d020cf-aa0c-48e4-8437-9a6d5d9cbeaa', '84d11b49-848a-4a5c-894c-92e16e2e29d7', 'default', '‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù', '', '{}', -1, '')
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,755 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,795 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,796 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 14:47:49 | INFO | stdout | FROM knowledge_base
2024-09-09 14:47:49 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,796 INFO sqlalchemy.engine.Engine [cached since 0.104s ago] ('private',)
2024-09-09 14:47:49 | INFO | stdout | 2024-09-09 14:47:49,798 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:47:50 | INFO | stdout | ÊàëÁé∞Âú®ËøõÂÖ•Âà∞KBFaissPool ‰∏≠Âï¶  ÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅ
2024-09-09 14:47:50 | INFO | stdout | 2024-09-09 14:47:50,804 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:47:50 | INFO | stdout | 2024-09-09 14:47:50,805 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 14:47:50 | INFO | stdout | FROM knowledge_base
2024-09-09 14:47:50 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 14:47:50 | INFO | stdout | 2024-09-09 14:47:50,806 INFO sqlalchemy.engine.Engine [cached since 1.114s ago] ('private',)
2024-09-09 14:47:50 | INFO | stdout | 2024-09-09 14:47:50,808 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:47:50 | INFO | stdout | ËøôÊòØÊü•ËØ¢Âà∞ÁöÑload_kb_embeddingsÁöÑÂèÇÊï∞Ôºö{'kb_name': 'private', 'kb_info': 'private', 'vs_type': 'faiss', 'embed_model': 'bge-large-zh-v1.5', 'file_count': 2, 'create_time': datetime.datetime(2024, 9, 3, 20, 21, 34)}
2024-09-09 14:47:50 | INFO | stdout | query==================
2024-09-09 14:47:50 | INFO | stdout | ‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù
2024-09-09 14:47:50 | INFO | stdout | docs====================
2024-09-09 14:47:50 | INFO | stdout | [(Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '0f6bebe3-003c-4eff-9e71-b2abed0f8427'}, page_content='1.GLMÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªüËß£Èáä\n\nÊó∂Ëá≥‰ªäÊó•ÔºåÂ§öËßíËâ≤ÂØπËØùÂü∫Êú¨‰∏äÂ∑≤ÁªèÊàê‰∫ÜÈ°∂Â∞ñÂ§ßÊ®°ÂûãÁöÑÊ†áÈÖç„ÄÇÊ≠£ÊòØÂü∫‰∫éÂ§öËßíËâ≤ÂØπËØùËøô‰∏ÄÂü∫Á°ÄÊäÄÊúØÊû∂ÊûÑÔºåÂ§ß Ê®°ÂûãÊâçËÉΩÈùûÂ∏∏ÁÅµÊ¥ªÁöÑÂÆûÁé∞ÂêÑÁ±ªÂØπËØùÈúÄÊ±ÇÔºåÁîöËá≥Â§öËßíËâ≤ÂØπËØù‰πüÊòØÊõ¥È´òÊïàÁöÑÂÆûÁé∞Function callingÁöÑÂü∫Á°ÄÔºåËÄåÂêéËÄÖ ÂàôÊòØÊï¥‰∏™AgentÂºÄÂèëÁöÑÂü∫Áü≥„ÄÇ'), 0.4692958), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '02434c50-3afc-46f3-a5f5-2052485e3d79'}, page_content='Âú®‰∏ä‰∏ÄÂ∞èËäÇ‰∏≠ÔºåÊàë‰ª¨Â∑≤ÁªèÈ°∫Âà©ÂÆåÊàêÊô∫Ë∞±AIË¥¶Âè∑Ê≥®ÂÜåÔºåÂπ∂Ëé∑ÂèñGLMÊ®°ÂûãAPI-KEYÔºåÂêåÊó∂ÂÆåÊàê‰∫ÜÊú¨Âú∞Ë∞ÉÁî®Êµã ËØï„ÄÇÊú¨ËäÇÊàë‰ª¨Â∞ÜÂºÄÂßãÁùÄÊâã‰ΩøÁî®GLM-4Ê®°ÂûãÔºåÂπ∂ËØ¶ÁªÜ‰ªãÁªçGLM-4Ë∞ÉÁî®ÂáΩÊï∞ÂèÇÊï∞ÂèäÊ®°ÂûãÁöÑÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªü„ÄÇ'), 0.7292065), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': 'bfda97f8-c748-4f7c-9af5-3f8a5e2d0464'}, page_content="4. Âü∫‰∫éGLM4ÂÆûÁé∞‰∏éÁî®Êà∑ÁöÑÂ§öËΩÆÂØπËØù\n\ndef chat_once(first_prompts,message):\n\ntry:\n\nresponse = client.chat.completions.create(model = 'glm-4'\n\n,messages = messages)"), 0.7523923)]
2024-09-09 14:47:50 | ERROR | stderr | [31mERROR[0m:    Exception in ASGI application
2024-09-09 14:47:50 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:47:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 284, in __call__
2024-09-09 14:47:50 | ERROR | stderr |     await wrap(partial(self.listen_for_disconnect, receive))
2024-09-09 14:47:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 14:47:50 | ERROR | stderr |     await func()
2024-09-09 14:47:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 223, in listen_for_disconnect
2024-09-09 14:47:50 | ERROR | stderr |     message = await receive()
2024-09-09 14:47:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 555, in receive
2024-09-09 14:47:50 | ERROR | stderr |     await self.message_event.wait()
2024-09-09 14:47:50 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/asyncio/locks.py", line 213, in wait
2024-09-09 14:47:50 | ERROR | stderr |     await fut
2024-09-09 14:47:50 | ERROR | stderr | asyncio.exceptions.CancelledError: Cancelled by cancel scope 7f51edadde70
2024-09-09 14:47:50 | ERROR | stderr | 
2024-09-09 14:47:50 | ERROR | stderr | During handling of the above exception, another exception occurred:
2024-09-09 14:47:50 | ERROR | stderr | 
2024-09-09 14:47:50 | ERROR | stderr |   + Exception Group Traceback (most recent call last):
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 401, in run_asgi
2024-09-09 14:47:50 | ERROR | stderr |   |     result = await app(  # type: ignore[func-returns-value]
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 70, in __call__
2024-09-09 14:47:50 | ERROR | stderr |   |     return await self.app(scope, receive, send)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
2024-09-09 14:47:50 | ERROR | stderr |   |     await super().__call__(scope, receive, send)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/applications.py", line 123, in __call__
2024-09-09 14:47:50 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 186, in __call__
2024-09-09 14:47:50 | ERROR | stderr |   |     raise exc
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 164, in __call__
2024-09-09 14:47:50 | ERROR | stderr |   |     await self.app(scope, receive, _send)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/cors.py", line 85, in __call__
2024-09-09 14:47:50 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
2024-09-09 14:47:50 | ERROR | stderr |   |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:47:50 | ERROR | stderr |   |     raise exc
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:47:50 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 756, in __call__
2024-09-09 14:47:50 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 776, in app
2024-09-09 14:47:50 | ERROR | stderr |   |     await route.handle(scope, receive, send)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 297, in handle
2024-09-09 14:47:50 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 77, in app
2024-09-09 14:47:50 | ERROR | stderr |   |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:47:50 | ERROR | stderr |   |     raise exc
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:47:50 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 75, in app
2024-09-09 14:47:50 | ERROR | stderr |   |     await response(scope, receive, send)
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 270, in __call__
2024-09-09 14:47:50 | ERROR | stderr |   |     async with anyio.create_task_group() as task_group:
2024-09-09 14:47:50 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 680, in __aexit__
2024-09-09 14:47:50 | ERROR | stderr |   |     raise BaseExceptionGroup(
2024-09-09 14:47:50 | ERROR | stderr |   | exceptiongroup.ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
2024-09-09 14:47:50 | ERROR | stderr |   +-+---------------- 1 ----------------
2024-09-09 14:47:50 | ERROR | stderr |     | Traceback (most recent call last):
2024-09-09 14:47:50 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 14:47:50 | ERROR | stderr |     |     await func()
2024-09-09 14:47:50 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 253, in stream_response
2024-09-09 14:47:50 | ERROR | stderr |     |     async for data in self.body_iterator:
2024-09-09 14:47:50 | ERROR | stderr |     |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/chat/knowledge_base_chat.py", line 115, in knowledge_base_chat_iterator
2024-09-09 14:47:50 | ERROR | stderr |     |     if USE_RERANKER:
2024-09-09 14:47:50 | ERROR | stderr |     | NameError: name 'USE_RERANKER' is not defined
2024-09-09 14:47:50 | ERROR | stderr |     +------------------------------------
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,826 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,827 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 14:48:05 | INFO | stdout | FROM knowledge_base
2024-09-09 14:48:05 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,828 INFO sqlalchemy.engine.Engine [cached since 16.14s ago] ('private',)
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,830 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:48:05 | INFO | stdout | [32mINFO[0m:     127.0.0.1:51116 - "[1mPOST /api/chat/knowledge_base_chat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,834 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,834 INFO sqlalchemy.engine.Engine SELECT conversation.id AS conversation_id, conversation.user_id AS conversation_user_id, conversation.name AS conversation_name, conversation.chat_type AS conversation_chat_type, conversation.create_time AS conversation_create_time
2024-09-09 14:48:05 | INFO | stdout | FROM conversation
2024-09-09 14:48:05 | INFO | stdout | WHERE conversation.id = %s
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,835 INFO sqlalchemy.engine.Engine [cached since 16.1s ago] ('84d11b49-848a-4a5c-894c-92e16e2e29d7',)
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,837 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,839 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,840 INFO sqlalchemy.engine.Engine INSERT INTO message (id, conversation_id, chat_type, query, response, meta_data, feedback_score, feedback_reason, create_time) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, now())
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,840 INFO sqlalchemy.engine.Engine [cached since 16.09s ago] ('5229d711-1833-481c-97b2-053c859b7d4f', '84d11b49-848a-4a5c-894c-92e16e2e29d7', 'default', '‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù', '', '{}', -1, '')
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,842 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,888 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,889 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 14:48:05 | INFO | stdout | FROM knowledge_base
2024-09-09 14:48:05 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,889 INFO sqlalchemy.engine.Engine [cached since 16.2s ago] ('private',)
2024-09-09 14:48:05 | INFO | stdout | 2024-09-09 14:48:05,892 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:48:05 | INFO | stdout | ÊàëÁé∞Âú®ËøõÂÖ•Âà∞KBFaissPool ‰∏≠Âï¶  ÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅ
2024-09-09 14:48:05 | INFO | stdout | query==================
2024-09-09 14:48:05 | INFO | stdout | ‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù
2024-09-09 14:48:05 | INFO | stdout | docs====================
2024-09-09 14:48:05 | INFO | stdout | [(Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '0f6bebe3-003c-4eff-9e71-b2abed0f8427'}, page_content='1.GLMÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªüËß£Èáä\n\nÊó∂Ëá≥‰ªäÊó•ÔºåÂ§öËßíËâ≤ÂØπËØùÂü∫Êú¨‰∏äÂ∑≤ÁªèÊàê‰∫ÜÈ°∂Â∞ñÂ§ßÊ®°ÂûãÁöÑÊ†áÈÖç„ÄÇÊ≠£ÊòØÂü∫‰∫éÂ§öËßíËâ≤ÂØπËØùËøô‰∏ÄÂü∫Á°ÄÊäÄÊúØÊû∂ÊûÑÔºåÂ§ß Ê®°ÂûãÊâçËÉΩÈùûÂ∏∏ÁÅµÊ¥ªÁöÑÂÆûÁé∞ÂêÑÁ±ªÂØπËØùÈúÄÊ±ÇÔºåÁîöËá≥Â§öËßíËâ≤ÂØπËØù‰πüÊòØÊõ¥È´òÊïàÁöÑÂÆûÁé∞Function callingÁöÑÂü∫Á°ÄÔºåËÄåÂêéËÄÖ ÂàôÊòØÊï¥‰∏™AgentÂºÄÂèëÁöÑÂü∫Áü≥„ÄÇ'), 0.4692958), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '02434c50-3afc-46f3-a5f5-2052485e3d79'}, page_content='Âú®‰∏ä‰∏ÄÂ∞èËäÇ‰∏≠ÔºåÊàë‰ª¨Â∑≤ÁªèÈ°∫Âà©ÂÆåÊàêÊô∫Ë∞±AIË¥¶Âè∑Ê≥®ÂÜåÔºåÂπ∂Ëé∑ÂèñGLMÊ®°ÂûãAPI-KEYÔºåÂêåÊó∂ÂÆåÊàê‰∫ÜÊú¨Âú∞Ë∞ÉÁî®Êµã ËØï„ÄÇÊú¨ËäÇÊàë‰ª¨Â∞ÜÂºÄÂßãÁùÄÊâã‰ΩøÁî®GLM-4Ê®°ÂûãÔºåÂπ∂ËØ¶ÁªÜ‰ªãÁªçGLM-4Ë∞ÉÁî®ÂáΩÊï∞ÂèÇÊï∞ÂèäÊ®°ÂûãÁöÑÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªü„ÄÇ'), 0.7292065), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': 'bfda97f8-c748-4f7c-9af5-3f8a5e2d0464'}, page_content="4. Âü∫‰∫éGLM4ÂÆûÁé∞‰∏éÁî®Êà∑ÁöÑÂ§öËΩÆÂØπËØù\n\ndef chat_once(first_prompts,message):\n\ntry:\n\nresponse = client.chat.completions.create(model = 'glm-4'\n\n,messages = messages)"), 0.7523923)]
2024-09-09 14:48:05 | ERROR | stderr | [31mERROR[0m:    Exception in ASGI application
2024-09-09 14:48:05 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:48:05 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 284, in __call__
2024-09-09 14:48:05 | ERROR | stderr |     await wrap(partial(self.listen_for_disconnect, receive))
2024-09-09 14:48:05 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 14:48:05 | ERROR | stderr |     await func()
2024-09-09 14:48:05 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 223, in listen_for_disconnect
2024-09-09 14:48:05 | ERROR | stderr |     message = await receive()
2024-09-09 14:48:05 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 555, in receive
2024-09-09 14:48:05 | ERROR | stderr |     await self.message_event.wait()
2024-09-09 14:48:05 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/asyncio/locks.py", line 213, in wait
2024-09-09 14:48:05 | ERROR | stderr |     await fut
2024-09-09 14:48:05 | ERROR | stderr | asyncio.exceptions.CancelledError: Cancelled by cancel scope 7f51d7d2c220
2024-09-09 14:48:05 | ERROR | stderr | 
2024-09-09 14:48:05 | ERROR | stderr | During handling of the above exception, another exception occurred:
2024-09-09 14:48:05 | ERROR | stderr | 
2024-09-09 14:48:05 | ERROR | stderr |   + Exception Group Traceback (most recent call last):
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 401, in run_asgi
2024-09-09 14:48:05 | ERROR | stderr |   |     result = await app(  # type: ignore[func-returns-value]
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 70, in __call__
2024-09-09 14:48:05 | ERROR | stderr |   |     return await self.app(scope, receive, send)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
2024-09-09 14:48:05 | ERROR | stderr |   |     await super().__call__(scope, receive, send)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/applications.py", line 123, in __call__
2024-09-09 14:48:05 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 186, in __call__
2024-09-09 14:48:05 | ERROR | stderr |   |     raise exc
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 164, in __call__
2024-09-09 14:48:05 | ERROR | stderr |   |     await self.app(scope, receive, _send)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/cors.py", line 85, in __call__
2024-09-09 14:48:05 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
2024-09-09 14:48:05 | ERROR | stderr |   |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:48:05 | ERROR | stderr |   |     raise exc
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:48:05 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 756, in __call__
2024-09-09 14:48:05 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 776, in app
2024-09-09 14:48:05 | ERROR | stderr |   |     await route.handle(scope, receive, send)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 297, in handle
2024-09-09 14:48:05 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 77, in app
2024-09-09 14:48:05 | ERROR | stderr |   |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:48:05 | ERROR | stderr |   |     raise exc
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:48:05 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 75, in app
2024-09-09 14:48:05 | ERROR | stderr |   |     await response(scope, receive, send)
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 270, in __call__
2024-09-09 14:48:05 | ERROR | stderr |   |     async with anyio.create_task_group() as task_group:
2024-09-09 14:48:05 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 680, in __aexit__
2024-09-09 14:48:05 | ERROR | stderr |   |     raise BaseExceptionGroup(
2024-09-09 14:48:05 | ERROR | stderr |   | exceptiongroup.ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
2024-09-09 14:48:05 | ERROR | stderr |   +-+---------------- 1 ----------------
2024-09-09 14:48:05 | ERROR | stderr |     | Traceback (most recent call last):
2024-09-09 14:48:05 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 14:48:05 | ERROR | stderr |     |     await func()
2024-09-09 14:48:05 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 253, in stream_response
2024-09-09 14:48:05 | ERROR | stderr |     |     async for data in self.body_iterator:
2024-09-09 14:48:05 | ERROR | stderr |     |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/chat/knowledge_base_chat.py", line 115, in knowledge_base_chat_iterator
2024-09-09 14:48:05 | ERROR | stderr |     |     if USE_RERANKER:
2024-09-09 14:48:05 | ERROR | stderr |     | NameError: name 'USE_RERANKER' is not defined
2024-09-09 14:48:05 | ERROR | stderr |     +------------------------------------
2024-09-09 14:48:25 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:48:25 | INFO | stdout | [32mINFO[0m:     127.0.0.1:33822 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:48:28 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:48:28 | INFO | stdout | [32mINFO[0m:     127.0.0.1:33824 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:49:10 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:49:10 | INFO | stdout | [32mINFO[0m:     127.0.0.1:52126 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:49:13 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:49:13 | INFO | stdout | [32mINFO[0m:     127.0.0.1:52132 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:49:55 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:49:55 | INFO | stdout | [32mINFO[0m:     127.0.0.1:40528 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:49:58 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:49:58 | INFO | stdout | [32mINFO[0m:     127.0.0.1:40534 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:50:40 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:50:40 | INFO | stdout | [32mINFO[0m:     127.0.0.1:47724 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:50:43 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:50:43 | INFO | stdout | [32mINFO[0m:     127.0.0.1:47730 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:51:02 | WARNING | controller | Sending SIGKILL to {'zhipu-api': <Process name='api_worker - zhipu-api (2018)' pid=2018 parent=1883 started daemon>}
2024-09-09 14:51:02 | WARNING | controller | Sending SIGKILL to {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (2017)' pid=2017 parent=1883 started daemon>}
2024-09-09 14:51:02 | WARNING | controller | Sending SIGKILL to <Process name='controller (1971)' pid=1971 parent=1883 started daemon>
2024-09-09 14:51:02 | WARNING | controller | Sending SIGKILL to <Process name='openai_api (2016)' pid=2016 parent=1883 started daemon>
2024-09-09 14:51:02 | WARNING | controller | Sending SIGKILL to <Process name='API Server (2160)' pid=2160 parent=1883 started daemon>
2024-09-09 14:51:02 | INFO | controller | Process status: {'zhipu-api': <Process name='api_worker - zhipu-api (2018)' pid=2018 parent=1883 started daemon>}
2024-09-09 14:51:02 | INFO | controller | Process status: {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (2017)' pid=2017 parent=1883 started daemon>}
2024-09-09 14:51:02 | INFO | controller | Process status: <Process name='controller (1971)' pid=1971 parent=1883 started daemon>
2024-09-09 14:51:02 | INFO | controller | Process status: <Process name='openai_api (2016)' pid=2016 parent=1883 started daemon>
2024-09-09 14:51:02 | INFO | controller | Process status: <Process name='API Server (2160)' pid=2160 parent=1883 started daemon>
2024-09-09 14:51:02 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 584, in <module>
2024-09-09 14:51:02 | ERROR | stderr |     loop.run_until_complete(start_main_server())
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 495, in start_main_server
2024-09-09 14:51:02 | ERROR | stderr |     cmd = queue.get()
2024-09-09 14:51:02 | ERROR | stderr |   File "<string>", line 2, in get
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 818, in _callmethod
2024-09-09 14:51:02 | ERROR | stderr |     kind, result = conn.recv()
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 255, in recv
2024-09-09 14:51:02 | ERROR | stderr |     buf = self._recv_bytes()
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 419, in _recv_bytes
2024-09-09 14:51:02 | ERROR | stderr |     buf = self._recv(4)
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 384, in _recv
2024-09-09 14:51:02 | ERROR | stderr |     chunk = read(handle, remaining)
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 14:51:02 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 14:51:02 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 14:51:02 | ERROR | stderr | Exception ignored in atexit callback: <function _exit_function at 0x7f9bc9712b90>
2024-09-09 14:51:02 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 334, in _exit_function
2024-09-09 14:51:02 | ERROR | stderr |     _run_finalizers(0)
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 300, in _run_finalizers
2024-09-09 14:51:02 | ERROR | stderr |     finalizer()
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 224, in __call__
2024-09-09 14:51:02 | ERROR | stderr |     res = self._callback(*self._args, **self._kwargs)
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 674, in _finalize_manager
2024-09-09 14:51:02 | ERROR | stderr |     process.join(timeout=1.0)
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/process.py", line 149, in join
2024-09-09 14:51:02 | ERROR | stderr |     res = self._popen.wait(timeout)
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/popen_fork.py", line 40, in wait
2024-09-09 14:51:02 | ERROR | stderr |     if not wait([self.sentinel], timeout):
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 936, in wait
2024-09-09 14:51:02 | ERROR | stderr |     ready = selector.select(timeout)
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/selectors.py", line 416, in select
2024-09-09 14:51:02 | ERROR | stderr |     fd_event_list = self._selector.poll(timeout)
2024-09-09 14:51:02 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 14:51:02 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 14:51:02 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 14:51:04 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:51:13 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:51:19 | INFO | controller | Ê≠£Âú®ÂêØÂä®ÊúçÂä°Ôºö
2024-09-09 14:51:19 | INFO | controller | Â¶ÇÈúÄÊü•Áúã ÊúçÂä°Êó•Âøó Êó•ÂøóÔºåËØ∑ÂâçÂæÄ /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:51:20 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:51:27 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m2421[0m]
2024-09-09 14:51:27 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:51:27 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:51:27 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20001[0m (Press CTRL+C to quit)
2024-09-09 14:51:27 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:51:27 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:51:27 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:51:34 | INFO | controller | Register a new worker: http://127.0.0.1:21001
2024-09-09 14:51:34 | INFO | controller | Register done: http://127.0.0.1:21001, {'model_names': ['zhipu-api'], 'speed': 1, 'queue_length': 0}
2024-09-09 14:51:34 | INFO | stdout | [32mINFO[0m:     127.0.0.1:37616 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:51:34 | ERROR | stderr | Loading checkpoint shards:   0%|                                                                                              | 0/7 [00:00<?, ?it/s]
2024-09-09 14:51:35 | ERROR | stderr | Loading checkpoint shards:  14%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé                                                                         | 1/7 [00:00<00:02,  2.22it/s]
2024-09-09 14:51:35 | ERROR | stderr | Loading checkpoint shards:  29%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå                                                             | 2/7 [00:00<00:02,  2.23it/s]
2024-09-09 14:51:36 | ERROR | stderr | Loading checkpoint shards:  43%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä                                                 | 3/7 [00:01<00:01,  2.27it/s]
2024-09-09 14:51:36 | ERROR | stderr | Loading checkpoint shards:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè                                    | 4/7 [00:01<00:01,  2.30it/s]
2024-09-09 14:51:36 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m2466[0m]
2024-09-09 14:51:36 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:51:36 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:51:36 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20000[0m (Press CTRL+C to quit)
2024-09-09 14:51:37 | ERROR | stderr | Loading checkpoint shards:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç                        | 5/7 [00:02<00:00,  2.27it/s]
2024-09-09 14:51:37 | ERROR | stderr | Loading checkpoint shards:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã            | 6/7 [00:02<00:00,  2.34it/s]
2024-09-09 14:51:37 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.60it/s]
2024-09-09 14:51:37 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.41it/s]
2024-09-09 14:51:37 | ERROR | stderr | 
2024-09-09 14:51:39 | INFO | controller | Register a new worker: http://127.0.0.1:20002
2024-09-09 14:51:39 | INFO | controller | Register done: http://127.0.0.1:20002, {'model_names': ['chatglm3-6b'], 'speed': 1, 'queue_length': 0}
2024-09-09 14:51:39 | INFO | stdout | [32mINFO[0m:     127.0.0.1:37626 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:51:39 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m2467[0m]
2024-09-09 14:51:39 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:51:39 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:51:39 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20002[0m (Press CTRL+C to quit)
2024-09-09 14:51:40 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:51:46 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m2610[0m]
2024-09-09 14:51:46 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:51:46 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:51:46 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:6006[0m (Press CTRL+C to quit)
2024-09-09 14:52:19 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:52:19 | INFO | stdout | [32mINFO[0m:     127.0.0.1:56522 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:52:24 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:52:24 | INFO | stdout | [32mINFO[0m:     127.0.0.1:41436 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,763 INFO sqlalchemy.engine.Engine SELECT DATABASE()
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,763 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,765 INFO sqlalchemy.engine.Engine SELECT @@sql_mode
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,766 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,767 INFO sqlalchemy.engine.Engine SELECT @@lower_case_table_names
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,767 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,769 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,808 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 14:52:29 | INFO | stdout | FROM knowledge_base
2024-09-09 14:52:29 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,809 INFO sqlalchemy.engine.Engine [generated in 0.00112s] ('private',)
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,812 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:52:29 | INFO | stdout | [32mINFO[0m:     127.0.0.1:41618 - "[1mPOST /api/chat/knowledge_base_chat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,834 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,837 INFO sqlalchemy.engine.Engine SELECT conversation.id AS conversation_id, conversation.user_id AS conversation_user_id, conversation.name AS conversation_name, conversation.chat_type AS conversation_chat_type, conversation.create_time AS conversation_create_time
2024-09-09 14:52:29 | INFO | stdout | FROM conversation
2024-09-09 14:52:29 | INFO | stdout | WHERE conversation.id = %s
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,838 INFO sqlalchemy.engine.Engine [generated in 0.00088s] ('84d11b49-848a-4a5c-894c-92e16e2e29d7',)
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,841 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,843 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,847 INFO sqlalchemy.engine.Engine INSERT INTO message (id, conversation_id, chat_type, query, response, meta_data, feedback_score, feedback_reason, create_time) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, now())
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,848 INFO sqlalchemy.engine.Engine [generated in 0.00088s] ('ebdad899-2a95-49f1-852f-871429643ff4', '84d11b49-848a-4a5c-894c-92e16e2e29d7', 'default', '‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù', '', '{}', -1, '')
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,851 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,888 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,889 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 14:52:29 | INFO | stdout | FROM knowledge_base
2024-09-09 14:52:29 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,890 INFO sqlalchemy.engine.Engine [cached since 0.08199s ago] ('private',)
2024-09-09 14:52:29 | INFO | stdout | 2024-09-09 14:52:29,892 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:52:30 | INFO | stdout | ÊàëÁé∞Âú®ËøõÂÖ•Âà∞KBFaissPool ‰∏≠Âï¶  ÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅ
2024-09-09 14:52:30 | INFO | stdout | 2024-09-09 14:52:30,860 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:52:30 | INFO | stdout | 2024-09-09 14:52:30,861 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 14:52:30 | INFO | stdout | FROM knowledge_base
2024-09-09 14:52:30 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 14:52:30 | INFO | stdout | 2024-09-09 14:52:30,861 INFO sqlalchemy.engine.Engine [cached since 1.054s ago] ('private',)
2024-09-09 14:52:30 | INFO | stdout | 2024-09-09 14:52:30,864 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:52:30 | INFO | stdout | ËøôÊòØÊü•ËØ¢Âà∞ÁöÑload_kb_embeddingsÁöÑÂèÇÊï∞Ôºö{'kb_name': 'private', 'kb_info': 'private', 'vs_type': 'faiss', 'embed_model': 'bge-large-zh-v1.5', 'file_count': 2, 'create_time': datetime.datetime(2024, 9, 3, 20, 21, 34)}
2024-09-09 14:52:30 | INFO | stdout | query==================
2024-09-09 14:52:30 | INFO | stdout | ‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù
2024-09-09 14:52:30 | INFO | stdout | docs====================
2024-09-09 14:52:30 | INFO | stdout | [(Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '0f6bebe3-003c-4eff-9e71-b2abed0f8427'}, page_content='1.GLMÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªüËß£Èáä\n\nÊó∂Ëá≥‰ªäÊó•ÔºåÂ§öËßíËâ≤ÂØπËØùÂü∫Êú¨‰∏äÂ∑≤ÁªèÊàê‰∫ÜÈ°∂Â∞ñÂ§ßÊ®°ÂûãÁöÑÊ†áÈÖç„ÄÇÊ≠£ÊòØÂü∫‰∫éÂ§öËßíËâ≤ÂØπËØùËøô‰∏ÄÂü∫Á°ÄÊäÄÊúØÊû∂ÊûÑÔºåÂ§ß Ê®°ÂûãÊâçËÉΩÈùûÂ∏∏ÁÅµÊ¥ªÁöÑÂÆûÁé∞ÂêÑÁ±ªÂØπËØùÈúÄÊ±ÇÔºåÁîöËá≥Â§öËßíËâ≤ÂØπËØù‰πüÊòØÊõ¥È´òÊïàÁöÑÂÆûÁé∞Function callingÁöÑÂü∫Á°ÄÔºåËÄåÂêéËÄÖ ÂàôÊòØÊï¥‰∏™AgentÂºÄÂèëÁöÑÂü∫Áü≥„ÄÇ'), 0.4692958), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '02434c50-3afc-46f3-a5f5-2052485e3d79'}, page_content='Âú®‰∏ä‰∏ÄÂ∞èËäÇ‰∏≠ÔºåÊàë‰ª¨Â∑≤ÁªèÈ°∫Âà©ÂÆåÊàêÊô∫Ë∞±AIË¥¶Âè∑Ê≥®ÂÜåÔºåÂπ∂Ëé∑ÂèñGLMÊ®°ÂûãAPI-KEYÔºåÂêåÊó∂ÂÆåÊàê‰∫ÜÊú¨Âú∞Ë∞ÉÁî®Êµã ËØï„ÄÇÊú¨ËäÇÊàë‰ª¨Â∞ÜÂºÄÂßãÁùÄÊâã‰ΩøÁî®GLM-4Ê®°ÂûãÔºåÂπ∂ËØ¶ÁªÜ‰ªãÁªçGLM-4Ë∞ÉÁî®ÂáΩÊï∞ÂèÇÊï∞ÂèäÊ®°ÂûãÁöÑÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªü„ÄÇ'), 0.7292065), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': 'bfda97f8-c748-4f7c-9af5-3f8a5e2d0464'}, page_content="4. Âü∫‰∫éGLM4ÂÆûÁé∞‰∏éÁî®Êà∑ÁöÑÂ§öËΩÆÂØπËØù\n\ndef chat_once(first_prompts,message):\n\ntry:\n\nresponse = client.chat.completions.create(model = 'glm-4'\n\n,messages = messages)"), 0.7523923)]
2024-09-09 14:52:30 | ERROR | stderr | [31mERROR[0m:    Exception in ASGI application
2024-09-09 14:52:30 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:52:30 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 284, in __call__
2024-09-09 14:52:30 | ERROR | stderr |     await wrap(partial(self.listen_for_disconnect, receive))
2024-09-09 14:52:30 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 14:52:30 | ERROR | stderr |     await func()
2024-09-09 14:52:30 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 223, in listen_for_disconnect
2024-09-09 14:52:30 | ERROR | stderr |     message = await receive()
2024-09-09 14:52:30 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 555, in receive
2024-09-09 14:52:30 | ERROR | stderr |     await self.message_event.wait()
2024-09-09 14:52:30 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/asyncio/locks.py", line 213, in wait
2024-09-09 14:52:30 | ERROR | stderr |     await fut
2024-09-09 14:52:30 | ERROR | stderr | asyncio.exceptions.CancelledError: Cancelled by cancel scope 7f27a40c9f00
2024-09-09 14:52:30 | ERROR | stderr | 
2024-09-09 14:52:30 | ERROR | stderr | During handling of the above exception, another exception occurred:
2024-09-09 14:52:30 | ERROR | stderr | 
2024-09-09 14:52:30 | ERROR | stderr |   + Exception Group Traceback (most recent call last):
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 401, in run_asgi
2024-09-09 14:52:30 | ERROR | stderr |   |     result = await app(  # type: ignore[func-returns-value]
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 70, in __call__
2024-09-09 14:52:30 | ERROR | stderr |   |     return await self.app(scope, receive, send)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
2024-09-09 14:52:30 | ERROR | stderr |   |     await super().__call__(scope, receive, send)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/applications.py", line 123, in __call__
2024-09-09 14:52:30 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 186, in __call__
2024-09-09 14:52:30 | ERROR | stderr |   |     raise exc
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 164, in __call__
2024-09-09 14:52:30 | ERROR | stderr |   |     await self.app(scope, receive, _send)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/cors.py", line 85, in __call__
2024-09-09 14:52:30 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
2024-09-09 14:52:30 | ERROR | stderr |   |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:52:30 | ERROR | stderr |   |     raise exc
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:52:30 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 756, in __call__
2024-09-09 14:52:30 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 776, in app
2024-09-09 14:52:30 | ERROR | stderr |   |     await route.handle(scope, receive, send)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 297, in handle
2024-09-09 14:52:30 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 77, in app
2024-09-09 14:52:30 | ERROR | stderr |   |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:52:30 | ERROR | stderr |   |     raise exc
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:52:30 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 75, in app
2024-09-09 14:52:30 | ERROR | stderr |   |     await response(scope, receive, send)
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 270, in __call__
2024-09-09 14:52:30 | ERROR | stderr |   |     async with anyio.create_task_group() as task_group:
2024-09-09 14:52:30 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 680, in __aexit__
2024-09-09 14:52:30 | ERROR | stderr |   |     raise BaseExceptionGroup(
2024-09-09 14:52:30 | ERROR | stderr |   | exceptiongroup.ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
2024-09-09 14:52:30 | ERROR | stderr |   +-+---------------- 1 ----------------
2024-09-09 14:52:30 | ERROR | stderr |     | Traceback (most recent call last):
2024-09-09 14:52:30 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 14:52:30 | ERROR | stderr |     |     await func()
2024-09-09 14:52:30 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 253, in stream_response
2024-09-09 14:52:30 | ERROR | stderr |     |     async for data in self.body_iterator:
2024-09-09 14:52:30 | ERROR | stderr |     |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/chat/knowledge_base_chat.py", line 117, in knowledge_base_chat_iterator
2024-09-09 14:52:30 | ERROR | stderr |     |     reranker_model_path = get_model_path(RERANKER_MODEL)
2024-09-09 14:52:30 | ERROR | stderr |     | NameError: name 'RERANKER_MODEL' is not defined
2024-09-09 14:52:30 | ERROR | stderr |     +------------------------------------
2024-09-09 14:53:04 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:53:04 | INFO | stdout | [32mINFO[0m:     127.0.0.1:47178 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:53:09 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:53:09 | INFO | stdout | [32mINFO[0m:     127.0.0.1:47194 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:53:34 | WARNING | controller | Sending SIGKILL to {'zhipu-api': <Process name='api_worker - zhipu-api (2468)' pid=2468 parent=2329 started daemon>}
2024-09-09 14:53:34 | WARNING | controller | Sending SIGKILL to {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (2467)' pid=2467 parent=2329 started daemon>}
2024-09-09 14:53:34 | WARNING | controller | Sending SIGKILL to <Process name='controller (2421)' pid=2421 parent=2329 started daemon>
2024-09-09 14:53:34 | WARNING | controller | Sending SIGKILL to <Process name='openai_api (2466)' pid=2466 parent=2329 started daemon>
2024-09-09 14:53:34 | WARNING | controller | Sending SIGKILL to <Process name='API Server (2610)' pid=2610 parent=2329 started daemon>
2024-09-09 14:53:34 | INFO | controller | Process status: {'zhipu-api': <Process name='api_worker - zhipu-api (2468)' pid=2468 parent=2329 started daemon>}
2024-09-09 14:53:34 | INFO | controller | Process status: {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (2467)' pid=2467 parent=2329 started daemon>}
2024-09-09 14:53:34 | INFO | controller | Process status: <Process name='controller (2421)' pid=2421 parent=2329 started daemon>
2024-09-09 14:53:34 | INFO | controller | Process status: <Process name='openai_api (2466)' pid=2466 parent=2329 started daemon>
2024-09-09 14:53:34 | INFO | controller | Process status: <Process name='API Server (2610)' pid=2610 parent=2329 started daemon>
2024-09-09 14:53:34 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:53:34 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 584, in <module>
2024-09-09 14:53:34 | ERROR | stderr |     loop.run_until_complete(start_main_server())
2024-09-09 14:53:34 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 495, in start_main_server
2024-09-09 14:53:34 | ERROR | stderr |     cmd = queue.get()
2024-09-09 14:53:34 | ERROR | stderr |   File "<string>", line 2, in get
2024-09-09 14:53:34 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 818, in _callmethod
2024-09-09 14:53:34 | ERROR | stderr |     kind, result = conn.recv()
2024-09-09 14:53:34 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 255, in recv
2024-09-09 14:53:34 | ERROR | stderr |     buf = self._recv_bytes()
2024-09-09 14:53:34 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 419, in _recv_bytes
2024-09-09 14:53:34 | ERROR | stderr |     buf = self._recv(4)
2024-09-09 14:53:34 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 384, in _recv
2024-09-09 14:53:34 | ERROR | stderr |     chunk = read(handle, remaining)
2024-09-09 14:53:34 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 14:53:34 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 14:53:34 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 14:53:35 | ERROR | stderr | Exception ignored in atexit callback: <function _exit_function at 0x7f53984e6b90>
2024-09-09 14:53:35 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:53:35 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 334, in _exit_function
2024-09-09 14:53:35 | ERROR | stderr |     _run_finalizers(0)
2024-09-09 14:53:35 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 300, in _run_finalizers
2024-09-09 14:53:35 | ERROR | stderr |     finalizer()
2024-09-09 14:53:35 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 224, in __call__
2024-09-09 14:53:35 | ERROR | stderr |     res = self._callback(*self._args, **self._kwargs)
2024-09-09 14:53:35 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 674, in _finalize_manager
2024-09-09 14:53:35 | ERROR | stderr |     process.join(timeout=1.0)
2024-09-09 14:53:35 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/process.py", line 149, in join
2024-09-09 14:53:35 | ERROR | stderr |     res = self._popen.wait(timeout)
2024-09-09 14:53:35 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/popen_fork.py", line 40, in wait
2024-09-09 14:53:35 | ERROR | stderr |     if not wait([self.sentinel], timeout):
2024-09-09 14:53:35 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 936, in wait
2024-09-09 14:53:35 | ERROR | stderr |     ready = selector.select(timeout)
2024-09-09 14:53:35 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/selectors.py", line 416, in select
2024-09-09 14:53:35 | ERROR | stderr |     fd_event_list = self._selector.poll(timeout)
2024-09-09 14:53:35 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 14:53:35 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 14:53:35 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 14:53:36 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:53:46 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:53:52 | INFO | controller | Ê≠£Âú®ÂêØÂä®ÊúçÂä°Ôºö
2024-09-09 14:53:52 | INFO | controller | Â¶ÇÈúÄÊü•Áúã ÊúçÂä°Êó•Âøó Êó•ÂøóÔºåËØ∑ÂâçÂæÄ /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:53:53 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:54:02 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m2828[0m]
2024-09-09 14:54:02 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:54:02 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:54:02 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20001[0m (Press CTRL+C to quit)
2024-09-09 14:54:02 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:54:02 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:54:03 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:54:09 | INFO | controller | Register a new worker: http://127.0.0.1:21001
2024-09-09 14:54:09 | INFO | controller | Register done: http://127.0.0.1:21001, {'model_names': ['zhipu-api'], 'speed': 1, 'queue_length': 0}
2024-09-09 14:54:09 | INFO | stdout | [32mINFO[0m:     127.0.0.1:49620 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:54:11 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m2873[0m]
2024-09-09 14:54:11 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:54:11 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:54:11 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20000[0m (Press CTRL+C to quit)
2024-09-09 14:54:12 | ERROR | stderr | Loading checkpoint shards:   0%|                                                                                              | 0/7 [00:00<?, ?it/s]
2024-09-09 14:54:12 | ERROR | stderr | Loading checkpoint shards:  14%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé                                                                         | 1/7 [00:00<00:02,  2.40it/s]
2024-09-09 14:54:13 | ERROR | stderr | Loading checkpoint shards:  29%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå                                                             | 2/7 [00:00<00:02,  2.45it/s]
2024-09-09 14:54:13 | ERROR | stderr | Loading checkpoint shards:  43%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä                                                 | 3/7 [00:01<00:01,  2.47it/s]
2024-09-09 14:54:13 | ERROR | stderr | Loading checkpoint shards:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè                                    | 4/7 [00:01<00:01,  2.39it/s]
2024-09-09 14:54:14 | ERROR | stderr | Loading checkpoint shards:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç                        | 5/7 [00:02<00:00,  2.39it/s]
2024-09-09 14:54:14 | ERROR | stderr | Loading checkpoint shards:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã            | 6/7 [00:02<00:00,  2.40it/s]
2024-09-09 14:54:15 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.54it/s]
2024-09-09 14:54:15 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.47it/s]
2024-09-09 14:54:15 | ERROR | stderr | 
2024-09-09 14:54:16 | INFO | controller | Register a new worker: http://127.0.0.1:20002
2024-09-09 14:54:16 | INFO | controller | Register done: http://127.0.0.1:20002, {'model_names': ['chatglm3-6b'], 'speed': 1, 'queue_length': 0}
2024-09-09 14:54:16 | INFO | stdout | [32mINFO[0m:     127.0.0.1:49622 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:54:16 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m2874[0m]
2024-09-09 14:54:16 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:54:16 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:54:16 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20002[0m (Press CTRL+C to quit)
2024-09-09 14:54:17 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 14:54:24 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m3018[0m]
2024-09-09 14:54:24 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 14:54:24 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 14:54:24 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:6006[0m (Press CTRL+C to quit)
2024-09-09 14:54:54 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:54:54 | INFO | stdout | [32mINFO[0m:     127.0.0.1:54652 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,582 INFO sqlalchemy.engine.Engine SELECT DATABASE()
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,582 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,584 INFO sqlalchemy.engine.Engine SELECT @@sql_mode
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,585 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,585 INFO sqlalchemy.engine.Engine SELECT @@lower_case_table_names
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,586 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,588 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,626 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 14:55:01 | INFO | stdout | FROM knowledge_base
2024-09-09 14:55:01 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,626 INFO sqlalchemy.engine.Engine [generated in 0.00100s] ('private',)
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,630 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:55:01 | INFO | stdout | [32mINFO[0m:     127.0.0.1:58548 - "[1mPOST /api/chat/knowledge_base_chat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,650 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,654 INFO sqlalchemy.engine.Engine SELECT conversation.id AS conversation_id, conversation.user_id AS conversation_user_id, conversation.name AS conversation_name, conversation.chat_type AS conversation_chat_type, conversation.create_time AS conversation_create_time
2024-09-09 14:55:01 | INFO | stdout | FROM conversation
2024-09-09 14:55:01 | INFO | stdout | WHERE conversation.id = %s
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,654 INFO sqlalchemy.engine.Engine [generated in 0.00082s] ('84d11b49-848a-4a5c-894c-92e16e2e29d7',)
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,657 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,659 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,664 INFO sqlalchemy.engine.Engine INSERT INTO message (id, conversation_id, chat_type, query, response, meta_data, feedback_score, feedback_reason, create_time) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, now())
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,664 INFO sqlalchemy.engine.Engine [generated in 0.00087s] ('5952b795-ce19-4518-8df2-f4364db56416', '84d11b49-848a-4a5c-894c-92e16e2e29d7', 'default', '‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù', '', '{}', -1, '')
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,667 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,704 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,705 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 14:55:01 | INFO | stdout | FROM knowledge_base
2024-09-09 14:55:01 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,706 INFO sqlalchemy.engine.Engine [cached since 0.08039s ago] ('private',)
2024-09-09 14:55:01 | INFO | stdout | 2024-09-09 14:55:01,708 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:55:01 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:55:01 | INFO | stdout | [32mINFO[0m:     127.0.0.1:35334 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:55:02 | INFO | stdout | ÊàëÁé∞Âú®ËøõÂÖ•Âà∞KBFaissPool ‰∏≠Âï¶  ÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅ
2024-09-09 14:55:02 | INFO | stdout | 2024-09-09 14:55:02,728 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 14:55:02 | INFO | stdout | 2024-09-09 14:55:02,729 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 14:55:02 | INFO | stdout | FROM knowledge_base
2024-09-09 14:55:02 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 14:55:02 | INFO | stdout | 2024-09-09 14:55:02,730 INFO sqlalchemy.engine.Engine [cached since 1.104s ago] ('private',)
2024-09-09 14:55:02 | INFO | stdout | 2024-09-09 14:55:02,733 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 14:55:02 | INFO | stdout | ËøôÊòØÊü•ËØ¢Âà∞ÁöÑload_kb_embeddingsÁöÑÂèÇÊï∞Ôºö{'kb_name': 'private', 'kb_info': 'private', 'vs_type': 'faiss', 'embed_model': 'bge-large-zh-v1.5', 'file_count': 2, 'create_time': datetime.datetime(2024, 9, 3, 20, 21, 34)}
2024-09-09 14:55:02 | INFO | stdout | query==================
2024-09-09 14:55:02 | INFO | stdout | ‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù
2024-09-09 14:55:02 | INFO | stdout | docs====================
2024-09-09 14:55:02 | INFO | stdout | [(Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '0f6bebe3-003c-4eff-9e71-b2abed0f8427'}, page_content='1.GLMÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªüËß£Èáä\n\nÊó∂Ëá≥‰ªäÊó•ÔºåÂ§öËßíËâ≤ÂØπËØùÂü∫Êú¨‰∏äÂ∑≤ÁªèÊàê‰∫ÜÈ°∂Â∞ñÂ§ßÊ®°ÂûãÁöÑÊ†áÈÖç„ÄÇÊ≠£ÊòØÂü∫‰∫éÂ§öËßíËâ≤ÂØπËØùËøô‰∏ÄÂü∫Á°ÄÊäÄÊúØÊû∂ÊûÑÔºåÂ§ß Ê®°ÂûãÊâçËÉΩÈùûÂ∏∏ÁÅµÊ¥ªÁöÑÂÆûÁé∞ÂêÑÁ±ªÂØπËØùÈúÄÊ±ÇÔºåÁîöËá≥Â§öËßíËâ≤ÂØπËØù‰πüÊòØÊõ¥È´òÊïàÁöÑÂÆûÁé∞Function callingÁöÑÂü∫Á°ÄÔºåËÄåÂêéËÄÖ ÂàôÊòØÊï¥‰∏™AgentÂºÄÂèëÁöÑÂü∫Áü≥„ÄÇ'), 0.4692958), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '02434c50-3afc-46f3-a5f5-2052485e3d79'}, page_content='Âú®‰∏ä‰∏ÄÂ∞èËäÇ‰∏≠ÔºåÊàë‰ª¨Â∑≤ÁªèÈ°∫Âà©ÂÆåÊàêÊô∫Ë∞±AIË¥¶Âè∑Ê≥®ÂÜåÔºåÂπ∂Ëé∑ÂèñGLMÊ®°ÂûãAPI-KEYÔºåÂêåÊó∂ÂÆåÊàê‰∫ÜÊú¨Âú∞Ë∞ÉÁî®Êµã ËØï„ÄÇÊú¨ËäÇÊàë‰ª¨Â∞ÜÂºÄÂßãÁùÄÊâã‰ΩøÁî®GLM-4Ê®°ÂûãÔºåÂπ∂ËØ¶ÁªÜ‰ªãÁªçGLM-4Ë∞ÉÁî®ÂáΩÊï∞ÂèÇÊï∞ÂèäÊ®°ÂûãÁöÑÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªü„ÄÇ'), 0.7292065), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': 'bfda97f8-c748-4f7c-9af5-3f8a5e2d0464'}, page_content="4. Âü∫‰∫éGLM4ÂÆûÁé∞‰∏éÁî®Êà∑ÁöÑÂ§öËΩÆÂØπËØù\n\ndef chat_once(first_prompts,message):\n\ntry:\n\nresponse = client.chat.completions.create(model = 'glm-4'\n\n,messages = messages)"), 0.7523923)]
2024-09-09 14:55:02 | ERROR | stderr | [31mERROR[0m:    Exception in ASGI application
2024-09-09 14:55:02 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 14:55:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 284, in __call__
2024-09-09 14:55:02 | ERROR | stderr |     await wrap(partial(self.listen_for_disconnect, receive))
2024-09-09 14:55:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 14:55:02 | ERROR | stderr |     await func()
2024-09-09 14:55:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 223, in listen_for_disconnect
2024-09-09 14:55:02 | ERROR | stderr |     message = await receive()
2024-09-09 14:55:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 555, in receive
2024-09-09 14:55:02 | ERROR | stderr |     await self.message_event.wait()
2024-09-09 14:55:02 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/asyncio/locks.py", line 213, in wait
2024-09-09 14:55:02 | ERROR | stderr |     await fut
2024-09-09 14:55:02 | ERROR | stderr | asyncio.exceptions.CancelledError: Cancelled by cancel scope 7facba875e10
2024-09-09 14:55:02 | ERROR | stderr | 
2024-09-09 14:55:02 | ERROR | stderr | During handling of the above exception, another exception occurred:
2024-09-09 14:55:02 | ERROR | stderr | 
2024-09-09 14:55:02 | ERROR | stderr |   + Exception Group Traceback (most recent call last):
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 401, in run_asgi
2024-09-09 14:55:02 | ERROR | stderr |   |     result = await app(  # type: ignore[func-returns-value]
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 70, in __call__
2024-09-09 14:55:02 | ERROR | stderr |   |     return await self.app(scope, receive, send)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
2024-09-09 14:55:02 | ERROR | stderr |   |     await super().__call__(scope, receive, send)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/applications.py", line 123, in __call__
2024-09-09 14:55:02 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 186, in __call__
2024-09-09 14:55:02 | ERROR | stderr |   |     raise exc
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 164, in __call__
2024-09-09 14:55:02 | ERROR | stderr |   |     await self.app(scope, receive, _send)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/cors.py", line 85, in __call__
2024-09-09 14:55:02 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
2024-09-09 14:55:02 | ERROR | stderr |   |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:55:02 | ERROR | stderr |   |     raise exc
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:55:02 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 756, in __call__
2024-09-09 14:55:02 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 776, in app
2024-09-09 14:55:02 | ERROR | stderr |   |     await route.handle(scope, receive, send)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 297, in handle
2024-09-09 14:55:02 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 77, in app
2024-09-09 14:55:02 | ERROR | stderr |   |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 14:55:02 | ERROR | stderr |   |     raise exc
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 14:55:02 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 75, in app
2024-09-09 14:55:02 | ERROR | stderr |   |     await response(scope, receive, send)
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 270, in __call__
2024-09-09 14:55:02 | ERROR | stderr |   |     async with anyio.create_task_group() as task_group:
2024-09-09 14:55:02 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 680, in __aexit__
2024-09-09 14:55:02 | ERROR | stderr |   |     raise BaseExceptionGroup(
2024-09-09 14:55:02 | ERROR | stderr |   | exceptiongroup.ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
2024-09-09 14:55:02 | ERROR | stderr |   +-+---------------- 1 ----------------
2024-09-09 14:55:02 | ERROR | stderr |     | Traceback (most recent call last):
2024-09-09 14:55:02 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 14:55:02 | ERROR | stderr |     |     await func()
2024-09-09 14:55:02 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 253, in stream_response
2024-09-09 14:55:02 | ERROR | stderr |     |     async for data in self.body_iterator:
2024-09-09 14:55:02 | ERROR | stderr |     |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/chat/knowledge_base_chat.py", line 119, in knowledge_base_chat_iterator
2024-09-09 14:55:02 | ERROR | stderr |     |     reranker_model_path = get_model_path(RERANKER_MODEL)
2024-09-09 14:55:02 | ERROR | stderr |     |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/utils.py", line 299, in get_model_path
2024-09-09 14:55:02 | ERROR | stderr |     |     path = Path(path_str)
2024-09-09 14:55:02 | ERROR | stderr |     | NameError: name 'Path' is not defined. Did you mean: 'paths'?
2024-09-09 14:55:02 | ERROR | stderr |     +------------------------------------
2024-09-09 14:55:40 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:55:40 | INFO | stdout | [32mINFO[0m:     127.0.0.1:36546 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:55:47 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:55:47 | INFO | stdout | [32mINFO[0m:     127.0.0.1:36562 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:56:25 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:56:25 | INFO | stdout | [32mINFO[0m:     127.0.0.1:59892 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:56:32 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:56:32 | INFO | stdout | [32mINFO[0m:     127.0.0.1:36326 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:57:10 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:57:10 | INFO | stdout | [32mINFO[0m:     127.0.0.1:52998 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:57:17 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:57:17 | INFO | stdout | [32mINFO[0m:     127.0.0.1:53010 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:57:55 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:57:55 | INFO | stdout | [32mINFO[0m:     127.0.0.1:45710 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:58:02 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:58:02 | INFO | stdout | [32mINFO[0m:     127.0.0.1:49826 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:58:40 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:58:40 | INFO | stdout | [32mINFO[0m:     127.0.0.1:41490 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:58:47 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:58:47 | INFO | stdout | [32mINFO[0m:     127.0.0.1:41506 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:59:25 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 14:59:25 | INFO | stdout | [32mINFO[0m:     127.0.0.1:37246 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 14:59:32 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 14:59:32 | INFO | stdout | [32mINFO[0m:     127.0.0.1:38946 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:00:10 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 15:00:10 | INFO | stdout | [32mINFO[0m:     127.0.0.1:45026 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:00:17 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 15:00:17 | INFO | stdout | [32mINFO[0m:     127.0.0.1:45036 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:00:55 | WARNING | controller | Sending SIGKILL to {'zhipu-api': <Process name='api_worker - zhipu-api (2875)' pid=2875 parent=2730 started daemon>}
2024-09-09 15:00:55 | WARNING | controller | Sending SIGKILL to {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (2874)' pid=2874 parent=2730 started daemon>}
2024-09-09 15:00:55 | WARNING | controller | Sending SIGKILL to <Process name='controller (2828)' pid=2828 parent=2730 started daemon>
2024-09-09 15:00:55 | WARNING | controller | Sending SIGKILL to <Process name='openai_api (2873)' pid=2873 parent=2730 started daemon>
2024-09-09 15:00:55 | WARNING | controller | Sending SIGKILL to <Process name='API Server (3018)' pid=3018 parent=2730 started daemon>
2024-09-09 15:00:55 | INFO | controller | Process status: {'zhipu-api': <Process name='api_worker - zhipu-api (2875)' pid=2875 parent=2730 started daemon>}
2024-09-09 15:00:55 | INFO | controller | Process status: {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (2874)' pid=2874 parent=2730 started daemon>}
2024-09-09 15:00:55 | INFO | controller | Process status: <Process name='controller (2828)' pid=2828 parent=2730 started daemon>
2024-09-09 15:00:55 | INFO | controller | Process status: <Process name='openai_api (2873)' pid=2873 parent=2730 started daemon>
2024-09-09 15:00:55 | INFO | controller | Process status: <Process name='API Server (3018)' pid=3018 parent=2730 started daemon>
2024-09-09 15:00:55 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 584, in <module>
2024-09-09 15:00:55 | ERROR | stderr |     loop.run_until_complete(start_main_server())
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 495, in start_main_server
2024-09-09 15:00:55 | ERROR | stderr |     cmd = queue.get()
2024-09-09 15:00:55 | ERROR | stderr |   File "<string>", line 2, in get
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 818, in _callmethod
2024-09-09 15:00:55 | ERROR | stderr |     kind, result = conn.recv()
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 255, in recv
2024-09-09 15:00:55 | ERROR | stderr |     buf = self._recv_bytes()
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 419, in _recv_bytes
2024-09-09 15:00:55 | ERROR | stderr |     buf = self._recv(4)
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 384, in _recv
2024-09-09 15:00:55 | ERROR | stderr |     chunk = read(handle, remaining)
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 15:00:55 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 15:00:55 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 15:00:55 | ERROR | stderr | Exception ignored in atexit callback: <function _exit_function at 0x7fe5d53beb90>
2024-09-09 15:00:55 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 334, in _exit_function
2024-09-09 15:00:55 | ERROR | stderr |     _run_finalizers(0)
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 300, in _run_finalizers
2024-09-09 15:00:55 | ERROR | stderr |     finalizer()
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 224, in __call__
2024-09-09 15:00:55 | ERROR | stderr |     res = self._callback(*self._args, **self._kwargs)
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 674, in _finalize_manager
2024-09-09 15:00:55 | ERROR | stderr |     process.join(timeout=1.0)
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/process.py", line 149, in join
2024-09-09 15:00:55 | ERROR | stderr |     res = self._popen.wait(timeout)
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/popen_fork.py", line 40, in wait
2024-09-09 15:00:55 | ERROR | stderr |     if not wait([self.sentinel], timeout):
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 936, in wait
2024-09-09 15:00:55 | ERROR | stderr |     ready = selector.select(timeout)
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/selectors.py", line 416, in select
2024-09-09 15:00:55 | ERROR | stderr |     fd_event_list = self._selector.poll(timeout)
2024-09-09 15:00:55 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 15:00:55 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 15:00:55 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 15:01:08 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:01:18 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:01:25 | INFO | controller | Ê≠£Âú®ÂêØÂä®ÊúçÂä°Ôºö
2024-09-09 15:01:25 | INFO | controller | Â¶ÇÈúÄÊü•Áúã ÊúçÂä°Êó•Âøó Êó•ÂøóÔºåËØ∑ÂâçÂæÄ /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:01:25 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:01:32 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m3318[0m]
2024-09-09 15:01:32 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:01:32 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:01:32 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20001[0m (Press CTRL+C to quit)
2024-09-09 15:01:33 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:01:33 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:01:33 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:01:39 | INFO | controller | Register a new worker: http://127.0.0.1:21001
2024-09-09 15:01:39 | INFO | controller | Register done: http://127.0.0.1:21001, {'model_names': ['zhipu-api'], 'speed': 1, 'queue_length': 0}
2024-09-09 15:01:39 | INFO | stdout | [32mINFO[0m:     127.0.0.1:33956 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:01:41 | ERROR | stderr | Loading checkpoint shards:   0%|                                                                                              | 0/7 [00:00<?, ?it/s]
2024-09-09 15:01:42 | ERROR | stderr | Loading checkpoint shards:  14%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé                                                                         | 1/7 [00:00<00:02,  2.31it/s]
2024-09-09 15:01:42 | ERROR | stderr | Loading checkpoint shards:  29%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå                                                             | 2/7 [00:00<00:02,  2.41it/s]
2024-09-09 15:01:42 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m3362[0m]
2024-09-09 15:01:42 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:01:42 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:01:42 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20000[0m (Press CTRL+C to quit)
2024-09-09 15:01:42 | ERROR | stderr | Loading checkpoint shards:  43%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä                                                 | 3/7 [00:01<00:01,  2.48it/s]
2024-09-09 15:01:43 | ERROR | stderr | Loading checkpoint shards:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè                                    | 4/7 [00:01<00:01,  2.53it/s]
2024-09-09 15:01:43 | ERROR | stderr | Loading checkpoint shards:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç                        | 5/7 [00:02<00:00,  2.52it/s]
2024-09-09 15:01:44 | ERROR | stderr | Loading checkpoint shards:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã            | 6/7 [00:02<00:00,  2.53it/s]
2024-09-09 15:01:44 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.74it/s]
2024-09-09 15:01:44 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.59it/s]
2024-09-09 15:01:44 | ERROR | stderr | 
2024-09-09 15:01:46 | INFO | controller | Register a new worker: http://127.0.0.1:20002
2024-09-09 15:01:46 | INFO | controller | Register done: http://127.0.0.1:20002, {'model_names': ['chatglm3-6b'], 'speed': 1, 'queue_length': 0}
2024-09-09 15:01:46 | INFO | stdout | [32mINFO[0m:     127.0.0.1:41544 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:01:46 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m3363[0m]
2024-09-09 15:01:46 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:01:46 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:01:46 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20002[0m (Press CTRL+C to quit)
2024-09-09 15:01:46 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:01:53 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m3511[0m]
2024-09-09 15:01:53 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:01:53 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:01:53 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:6006[0m (Press CTRL+C to quit)
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,164 INFO sqlalchemy.engine.Engine SELECT DATABASE()
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,164 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,168 INFO sqlalchemy.engine.Engine SELECT @@sql_mode
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,168 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,170 INFO sqlalchemy.engine.Engine SELECT @@lower_case_table_names
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,170 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,174 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,212 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:02:19 | INFO | stdout | FROM knowledge_base
2024-09-09 15:02:19 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,212 INFO sqlalchemy.engine.Engine [generated in 0.00099s] ('private',)
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,216 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:02:19 | INFO | stdout | [32mINFO[0m:     127.0.0.1:56888 - "[1mPOST /api/chat/knowledge_base_chat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,235 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,239 INFO sqlalchemy.engine.Engine SELECT conversation.id AS conversation_id, conversation.user_id AS conversation_user_id, conversation.name AS conversation_name, conversation.chat_type AS conversation_chat_type, conversation.create_time AS conversation_create_time
2024-09-09 15:02:19 | INFO | stdout | FROM conversation
2024-09-09 15:02:19 | INFO | stdout | WHERE conversation.id = %s
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,239 INFO sqlalchemy.engine.Engine [generated in 0.00083s] ('84d11b49-848a-4a5c-894c-92e16e2e29d7',)
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,242 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,244 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,248 INFO sqlalchemy.engine.Engine INSERT INTO message (id, conversation_id, chat_type, query, response, meta_data, feedback_score, feedback_reason, create_time) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, now())
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,248 INFO sqlalchemy.engine.Engine [generated in 0.00076s] ('de5c2631-02e1-4553-9f83-e989ec81a6ad', '84d11b49-848a-4a5c-894c-92e16e2e29d7', 'default', '‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù', '', '{}', -1, '')
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,251 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,287 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:02:19 | INFO | stdout | FROM knowledge_base
2024-09-09 15:02:19 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,288 INFO sqlalchemy.engine.Engine [cached since 0.07661s ago] ('private',)
2024-09-09 15:02:19 | INFO | stdout | 2024-09-09 15:02:19,290 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:02:20 | INFO | stdout | ÊàëÁé∞Âú®ËøõÂÖ•Âà∞KBFaissPool ‰∏≠Âï¶  ÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅ
2024-09-09 15:02:20 | INFO | stdout | 2024-09-09 15:02:20,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:02:20 | INFO | stdout | 2024-09-09 15:02:20,302 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:02:20 | INFO | stdout | FROM knowledge_base
2024-09-09 15:02:20 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:02:20 | INFO | stdout | 2024-09-09 15:02:20,303 INFO sqlalchemy.engine.Engine [cached since 1.092s ago] ('private',)
2024-09-09 15:02:20 | INFO | stdout | 2024-09-09 15:02:20,305 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:02:20 | INFO | stdout | ËøôÊòØÊü•ËØ¢Âà∞ÁöÑload_kb_embeddingsÁöÑÂèÇÊï∞Ôºö{'kb_name': 'private', 'kb_info': 'private', 'vs_type': 'faiss', 'embed_model': 'bge-large-zh-v1.5', 'file_count': 2, 'create_time': datetime.datetime(2024, 9, 3, 20, 21, 34)}
2024-09-09 15:02:20 | INFO | stdout | query==================
2024-09-09 15:02:20 | INFO | stdout | ‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù
2024-09-09 15:02:20 | INFO | stdout | docs====================
2024-09-09 15:02:20 | INFO | stdout | [(Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '0f6bebe3-003c-4eff-9e71-b2abed0f8427'}, page_content='1.GLMÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªüËß£Èáä\n\nÊó∂Ëá≥‰ªäÊó•ÔºåÂ§öËßíËâ≤ÂØπËØùÂü∫Êú¨‰∏äÂ∑≤ÁªèÊàê‰∫ÜÈ°∂Â∞ñÂ§ßÊ®°ÂûãÁöÑÊ†áÈÖç„ÄÇÊ≠£ÊòØÂü∫‰∫éÂ§öËßíËâ≤ÂØπËØùËøô‰∏ÄÂü∫Á°ÄÊäÄÊúØÊû∂ÊûÑÔºåÂ§ß Ê®°ÂûãÊâçËÉΩÈùûÂ∏∏ÁÅµÊ¥ªÁöÑÂÆûÁé∞ÂêÑÁ±ªÂØπËØùÈúÄÊ±ÇÔºåÁîöËá≥Â§öËßíËâ≤ÂØπËØù‰πüÊòØÊõ¥È´òÊïàÁöÑÂÆûÁé∞Function callingÁöÑÂü∫Á°ÄÔºåËÄåÂêéËÄÖ ÂàôÊòØÊï¥‰∏™AgentÂºÄÂèëÁöÑÂü∫Áü≥„ÄÇ'), 0.4692958), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '02434c50-3afc-46f3-a5f5-2052485e3d79'}, page_content='Âú®‰∏ä‰∏ÄÂ∞èËäÇ‰∏≠ÔºåÊàë‰ª¨Â∑≤ÁªèÈ°∫Âà©ÂÆåÊàêÊô∫Ë∞±AIË¥¶Âè∑Ê≥®ÂÜåÔºåÂπ∂Ëé∑ÂèñGLMÊ®°ÂûãAPI-KEYÔºåÂêåÊó∂ÂÆåÊàê‰∫ÜÊú¨Âú∞Ë∞ÉÁî®Êµã ËØï„ÄÇÊú¨ËäÇÊàë‰ª¨Â∞ÜÂºÄÂßãÁùÄÊâã‰ΩøÁî®GLM-4Ê®°ÂûãÔºåÂπ∂ËØ¶ÁªÜ‰ªãÁªçGLM-4Ë∞ÉÁî®ÂáΩÊï∞ÂèÇÊï∞ÂèäÊ®°ÂûãÁöÑÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªü„ÄÇ'), 0.7292065), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': 'bfda97f8-c748-4f7c-9af5-3f8a5e2d0464'}, page_content="4. Âü∫‰∫éGLM4ÂÆûÁé∞‰∏éÁî®Êà∑ÁöÑÂ§öËΩÆÂØπËØù\n\ndef chat_once(first_prompts,message):\n\ntry:\n\nresponse = client.chat.completions.create(model = 'glm-4'\n\n,messages = messages)"), 0.7523923)]
2024-09-09 15:02:20 | ERROR | stderr | [31mERROR[0m:    Exception in ASGI application
2024-09-09 15:02:20 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 15:02:20 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 284, in __call__
2024-09-09 15:02:20 | ERROR | stderr |     await wrap(partial(self.listen_for_disconnect, receive))
2024-09-09 15:02:20 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 15:02:20 | ERROR | stderr |     await func()
2024-09-09 15:02:20 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 223, in listen_for_disconnect
2024-09-09 15:02:20 | ERROR | stderr |     message = await receive()
2024-09-09 15:02:20 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 555, in receive
2024-09-09 15:02:20 | ERROR | stderr |     await self.message_event.wait()
2024-09-09 15:02:20 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/asyncio/locks.py", line 213, in wait
2024-09-09 15:02:20 | ERROR | stderr |     await fut
2024-09-09 15:02:20 | ERROR | stderr | asyncio.exceptions.CancelledError: Cancelled by cancel scope 7f8666d85f30
2024-09-09 15:02:20 | ERROR | stderr | 
2024-09-09 15:02:20 | ERROR | stderr | During handling of the above exception, another exception occurred:
2024-09-09 15:02:20 | ERROR | stderr | 
2024-09-09 15:02:20 | ERROR | stderr |   + Exception Group Traceback (most recent call last):
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 401, in run_asgi
2024-09-09 15:02:20 | ERROR | stderr |   |     result = await app(  # type: ignore[func-returns-value]
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 70, in __call__
2024-09-09 15:02:20 | ERROR | stderr |   |     return await self.app(scope, receive, send)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
2024-09-09 15:02:20 | ERROR | stderr |   |     await super().__call__(scope, receive, send)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/applications.py", line 123, in __call__
2024-09-09 15:02:20 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 186, in __call__
2024-09-09 15:02:20 | ERROR | stderr |   |     raise exc
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 164, in __call__
2024-09-09 15:02:20 | ERROR | stderr |   |     await self.app(scope, receive, _send)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/cors.py", line 85, in __call__
2024-09-09 15:02:20 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
2024-09-09 15:02:20 | ERROR | stderr |   |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 15:02:20 | ERROR | stderr |   |     raise exc
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 15:02:20 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 756, in __call__
2024-09-09 15:02:20 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 776, in app
2024-09-09 15:02:20 | ERROR | stderr |   |     await route.handle(scope, receive, send)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 297, in handle
2024-09-09 15:02:20 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 77, in app
2024-09-09 15:02:20 | ERROR | stderr |   |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 15:02:20 | ERROR | stderr |   |     raise exc
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 15:02:20 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 75, in app
2024-09-09 15:02:20 | ERROR | stderr |   |     await response(scope, receive, send)
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 270, in __call__
2024-09-09 15:02:20 | ERROR | stderr |   |     async with anyio.create_task_group() as task_group:
2024-09-09 15:02:20 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 680, in __aexit__
2024-09-09 15:02:20 | ERROR | stderr |   |     raise BaseExceptionGroup(
2024-09-09 15:02:20 | ERROR | stderr |   | exceptiongroup.ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
2024-09-09 15:02:20 | ERROR | stderr |   +-+---------------- 1 ----------------
2024-09-09 15:02:20 | ERROR | stderr |     | Traceback (most recent call last):
2024-09-09 15:02:20 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 15:02:20 | ERROR | stderr |     |     await func()
2024-09-09 15:02:20 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 253, in stream_response
2024-09-09 15:02:20 | ERROR | stderr |     |     async for data in self.body_iterator:
2024-09-09 15:02:20 | ERROR | stderr |     |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/chat/knowledge_base_chat.py", line 119, in knowledge_base_chat_iterator
2024-09-09 15:02:20 | ERROR | stderr |     |     reranker_model_path = get_model_path(RERANKER_MODEL)
2024-09-09 15:02:20 | ERROR | stderr |     |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/utils.py", line 299, in get_model_path
2024-09-09 15:02:20 | ERROR | stderr |     |     path = Path(path_str)
2024-09-09 15:02:20 | ERROR | stderr |     | NameError: name 'Path' is not defined. Did you mean: 'paths'?
2024-09-09 15:02:20 | ERROR | stderr |     +------------------------------------
2024-09-09 15:02:24 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 15:02:24 | INFO | stdout | [32mINFO[0m:     127.0.0.1:58450 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:02:31 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 15:02:31 | INFO | stdout | [32mINFO[0m:     127.0.0.1:60210 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:02:52 | WARNING | controller | Sending SIGKILL to {'zhipu-api': <Process name='api_worker - zhipu-api (3364)' pid=3364 parent=3229 started daemon>}
2024-09-09 15:02:52 | WARNING | controller | Sending SIGKILL to {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (3363)' pid=3363 parent=3229 started daemon>}
2024-09-09 15:02:52 | WARNING | controller | Sending SIGKILL to <Process name='controller (3318)' pid=3318 parent=3229 started daemon>
2024-09-09 15:02:52 | WARNING | controller | Sending SIGKILL to <Process name='openai_api (3362)' pid=3362 parent=3229 started daemon>
2024-09-09 15:02:52 | WARNING | controller | Sending SIGKILL to <Process name='API Server (3511)' pid=3511 parent=3229 started daemon>
2024-09-09 15:02:52 | INFO | controller | Process status: {'zhipu-api': <Process name='api_worker - zhipu-api (3364)' pid=3364 parent=3229 started daemon>}
2024-09-09 15:02:52 | INFO | controller | Process status: {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (3363)' pid=3363 parent=3229 started daemon>}
2024-09-09 15:02:52 | INFO | controller | Process status: <Process name='controller (3318)' pid=3318 parent=3229 started daemon>
2024-09-09 15:02:52 | INFO | controller | Process status: <Process name='openai_api (3362)' pid=3362 parent=3229 started daemon>
2024-09-09 15:02:52 | INFO | controller | Process status: <Process name='API Server (3511)' pid=3511 parent=3229 started daemon>
2024-09-09 15:02:52 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 15:02:52 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 584, in <module>
2024-09-09 15:02:52 | ERROR | stderr |     loop.run_until_complete(start_main_server())
2024-09-09 15:02:52 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 495, in start_main_server
2024-09-09 15:02:52 | ERROR | stderr |     cmd = queue.get()
2024-09-09 15:02:52 | ERROR | stderr |   File "<string>", line 2, in get
2024-09-09 15:02:52 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 818, in _callmethod
2024-09-09 15:02:52 | ERROR | stderr |     kind, result = conn.recv()
2024-09-09 15:02:52 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 255, in recv
2024-09-09 15:02:52 | ERROR | stderr |     buf = self._recv_bytes()
2024-09-09 15:02:52 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 419, in _recv_bytes
2024-09-09 15:02:52 | ERROR | stderr |     buf = self._recv(4)
2024-09-09 15:02:52 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 384, in _recv
2024-09-09 15:02:52 | ERROR | stderr |     chunk = read(handle, remaining)
2024-09-09 15:02:52 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 15:02:52 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 15:02:52 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 15:03:40 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:03:51 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:04:01 | INFO | controller | Ê≠£Âú®ÂêØÂä®ÊúçÂä°Ôºö
2024-09-09 15:04:01 | INFO | controller | Â¶ÇÈúÄÊü•Áúã ÊúçÂä°Êó•Âøó Êó•ÂøóÔºåËØ∑ÂâçÂæÄ /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:04:01 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:04:08 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m3718[0m]
2024-09-09 15:04:08 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:04:08 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:04:08 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20001[0m (Press CTRL+C to quit)
2024-09-09 15:04:09 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:04:09 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:04:09 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:04:16 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m3762[0m]
2024-09-09 15:04:16 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:04:16 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:04:16 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20000[0m (Press CTRL+C to quit)
2024-09-09 15:04:16 | INFO | controller | Register a new worker: http://127.0.0.1:21001
2024-09-09 15:04:16 | INFO | controller | Register done: http://127.0.0.1:21001, {'model_names': ['zhipu-api'], 'speed': 1, 'queue_length': 0}
2024-09-09 15:04:16 | INFO | stdout | [32mINFO[0m:     127.0.0.1:57456 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:04:18 | ERROR | stderr | Loading checkpoint shards:   0%|                                                                                              | 0/7 [00:00<?, ?it/s]
2024-09-09 15:04:19 | ERROR | stderr | Loading checkpoint shards:  14%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé                                                                         | 1/7 [00:00<00:03,  1.89it/s]
2024-09-09 15:04:19 | ERROR | stderr | Loading checkpoint shards:  29%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå                                                             | 2/7 [00:01<00:02,  1.84it/s]
2024-09-09 15:04:20 | ERROR | stderr | Loading checkpoint shards:  43%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä                                                 | 3/7 [00:01<00:02,  1.86it/s]
2024-09-09 15:04:20 | ERROR | stderr | Loading checkpoint shards:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè                                    | 4/7 [00:02<00:01,  1.98it/s]
2024-09-09 15:04:21 | ERROR | stderr | Loading checkpoint shards:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç                        | 5/7 [00:02<00:00,  2.04it/s]
2024-09-09 15:04:21 | ERROR | stderr | Loading checkpoint shards:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã            | 6/7 [00:02<00:00,  2.10it/s]
2024-09-09 15:04:21 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:03<00:00,  2.36it/s]
2024-09-09 15:04:21 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:03<00:00,  2.12it/s]
2024-09-09 15:04:21 | ERROR | stderr | 
2024-09-09 15:04:24 | INFO | controller | Register a new worker: http://127.0.0.1:20002
2024-09-09 15:04:24 | INFO | controller | Register done: http://127.0.0.1:20002, {'model_names': ['chatglm3-6b'], 'speed': 1, 'queue_length': 0}
2024-09-09 15:04:24 | INFO | stdout | [32mINFO[0m:     127.0.0.1:41354 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:04:24 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m3763[0m]
2024-09-09 15:04:24 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:04:24 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:04:24 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20002[0m (Press CTRL+C to quit)
2024-09-09 15:04:24 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:04:31 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m3907[0m]
2024-09-09 15:04:31 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:04:31 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:04:31 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:6006[0m (Press CTRL+C to quit)
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,368 INFO sqlalchemy.engine.Engine SELECT DATABASE()
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,369 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,370 INFO sqlalchemy.engine.Engine SELECT @@sql_mode
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,371 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,372 INFO sqlalchemy.engine.Engine SELECT @@lower_case_table_names
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,372 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,374 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,412 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:04:42 | INFO | stdout | FROM knowledge_base
2024-09-09 15:04:42 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,413 INFO sqlalchemy.engine.Engine [generated in 0.00099s] ('private',)
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,416 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:04:42 | INFO | stdout | [32mINFO[0m:     127.0.0.1:44674 - "[1mPOST /api/chat/knowledge_base_chat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,434 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,438 INFO sqlalchemy.engine.Engine SELECT conversation.id AS conversation_id, conversation.user_id AS conversation_user_id, conversation.name AS conversation_name, conversation.chat_type AS conversation_chat_type, conversation.create_time AS conversation_create_time
2024-09-09 15:04:42 | INFO | stdout | FROM conversation
2024-09-09 15:04:42 | INFO | stdout | WHERE conversation.id = %s
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,439 INFO sqlalchemy.engine.Engine [generated in 0.00085s] ('84d11b49-848a-4a5c-894c-92e16e2e29d7',)
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,441 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,443 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,447 INFO sqlalchemy.engine.Engine INSERT INTO message (id, conversation_id, chat_type, query, response, meta_data, feedback_score, feedback_reason, create_time) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, now())
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,447 INFO sqlalchemy.engine.Engine [generated in 0.00077s] ('b2e05ed7-1f18-4cf2-a197-6478af06b58a', '84d11b49-848a-4a5c-894c-92e16e2e29d7', 'default', '‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù', '', '{}', -1, '')
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,450 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,484 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,484 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:04:42 | INFO | stdout | FROM knowledge_base
2024-09-09 15:04:42 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,485 INFO sqlalchemy.engine.Engine [cached since 0.07321s ago] ('private',)
2024-09-09 15:04:42 | INFO | stdout | 2024-09-09 15:04:42,487 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:04:43 | INFO | stdout | ÊàëÁé∞Âú®ËøõÂÖ•Âà∞KBFaissPool ‰∏≠Âï¶  ÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅ
2024-09-09 15:04:43 | INFO | stdout | 2024-09-09 15:04:43,496 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:04:43 | INFO | stdout | 2024-09-09 15:04:43,497 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:04:43 | INFO | stdout | FROM knowledge_base
2024-09-09 15:04:43 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:04:43 | INFO | stdout | 2024-09-09 15:04:43,497 INFO sqlalchemy.engine.Engine [cached since 1.086s ago] ('private',)
2024-09-09 15:04:43 | INFO | stdout | 2024-09-09 15:04:43,500 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:04:43 | INFO | stdout | ËøôÊòØÊü•ËØ¢Âà∞ÁöÑload_kb_embeddingsÁöÑÂèÇÊï∞Ôºö{'kb_name': 'private', 'kb_info': 'private', 'vs_type': 'faiss', 'embed_model': 'bge-large-zh-v1.5', 'file_count': 2, 'create_time': datetime.datetime(2024, 9, 3, 20, 21, 34)}
2024-09-09 15:04:43 | INFO | stdout | query==================
2024-09-09 15:04:43 | INFO | stdout | ‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù
2024-09-09 15:04:43 | INFO | stdout | docs====================
2024-09-09 15:04:43 | INFO | stdout | [(Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '0f6bebe3-003c-4eff-9e71-b2abed0f8427'}, page_content='1.GLMÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªüËß£Èáä\n\nÊó∂Ëá≥‰ªäÊó•ÔºåÂ§öËßíËâ≤ÂØπËØùÂü∫Êú¨‰∏äÂ∑≤ÁªèÊàê‰∫ÜÈ°∂Â∞ñÂ§ßÊ®°ÂûãÁöÑÊ†áÈÖç„ÄÇÊ≠£ÊòØÂü∫‰∫éÂ§öËßíËâ≤ÂØπËØùËøô‰∏ÄÂü∫Á°ÄÊäÄÊúØÊû∂ÊûÑÔºåÂ§ß Ê®°ÂûãÊâçËÉΩÈùûÂ∏∏ÁÅµÊ¥ªÁöÑÂÆûÁé∞ÂêÑÁ±ªÂØπËØùÈúÄÊ±ÇÔºåÁîöËá≥Â§öËßíËâ≤ÂØπËØù‰πüÊòØÊõ¥È´òÊïàÁöÑÂÆûÁé∞Function callingÁöÑÂü∫Á°ÄÔºåËÄåÂêéËÄÖ ÂàôÊòØÊï¥‰∏™AgentÂºÄÂèëÁöÑÂü∫Áü≥„ÄÇ'), 0.4692958), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '02434c50-3afc-46f3-a5f5-2052485e3d79'}, page_content='Âú®‰∏ä‰∏ÄÂ∞èËäÇ‰∏≠ÔºåÊàë‰ª¨Â∑≤ÁªèÈ°∫Âà©ÂÆåÊàêÊô∫Ë∞±AIË¥¶Âè∑Ê≥®ÂÜåÔºåÂπ∂Ëé∑ÂèñGLMÊ®°ÂûãAPI-KEYÔºåÂêåÊó∂ÂÆåÊàê‰∫ÜÊú¨Âú∞Ë∞ÉÁî®Êµã ËØï„ÄÇÊú¨ËäÇÊàë‰ª¨Â∞ÜÂºÄÂßãÁùÄÊâã‰ΩøÁî®GLM-4Ê®°ÂûãÔºåÂπ∂ËØ¶ÁªÜ‰ªãÁªçGLM-4Ë∞ÉÁî®ÂáΩÊï∞ÂèÇÊï∞ÂèäÊ®°ÂûãÁöÑÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªü„ÄÇ'), 0.7292065), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': 'bfda97f8-c748-4f7c-9af5-3f8a5e2d0464'}, page_content="4. Âü∫‰∫éGLM4ÂÆûÁé∞‰∏éÁî®Êà∑ÁöÑÂ§öËΩÆÂØπËØù\n\ndef chat_once(first_prompts,message):\n\ntry:\n\nresponse = client.chat.completions.create(model = 'glm-4'\n\n,messages = messages)"), 0.7523923)]
2024-09-09 15:04:43 | ERROR | stderr | [31mERROR[0m:    Exception in ASGI application
2024-09-09 15:04:43 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 15:04:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 284, in __call__
2024-09-09 15:04:43 | ERROR | stderr |     await wrap(partial(self.listen_for_disconnect, receive))
2024-09-09 15:04:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 15:04:43 | ERROR | stderr |     await func()
2024-09-09 15:04:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 223, in listen_for_disconnect
2024-09-09 15:04:43 | ERROR | stderr |     message = await receive()
2024-09-09 15:04:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 555, in receive
2024-09-09 15:04:43 | ERROR | stderr |     await self.message_event.wait()
2024-09-09 15:04:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/asyncio/locks.py", line 213, in wait
2024-09-09 15:04:43 | ERROR | stderr |     await fut
2024-09-09 15:04:43 | ERROR | stderr | asyncio.exceptions.CancelledError: Cancelled by cancel scope 7fc5ddda1f00
2024-09-09 15:04:43 | ERROR | stderr | 
2024-09-09 15:04:43 | ERROR | stderr | During handling of the above exception, another exception occurred:
2024-09-09 15:04:43 | ERROR | stderr | 
2024-09-09 15:04:43 | ERROR | stderr |   + Exception Group Traceback (most recent call last):
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 401, in run_asgi
2024-09-09 15:04:43 | ERROR | stderr |   |     result = await app(  # type: ignore[func-returns-value]
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 70, in __call__
2024-09-09 15:04:43 | ERROR | stderr |   |     return await self.app(scope, receive, send)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
2024-09-09 15:04:43 | ERROR | stderr |   |     await super().__call__(scope, receive, send)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/applications.py", line 123, in __call__
2024-09-09 15:04:43 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 186, in __call__
2024-09-09 15:04:43 | ERROR | stderr |   |     raise exc
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/errors.py", line 164, in __call__
2024-09-09 15:04:43 | ERROR | stderr |   |     await self.app(scope, receive, _send)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/cors.py", line 85, in __call__
2024-09-09 15:04:43 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
2024-09-09 15:04:43 | ERROR | stderr |   |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 15:04:43 | ERROR | stderr |   |     raise exc
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 15:04:43 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 756, in __call__
2024-09-09 15:04:43 | ERROR | stderr |   |     await self.middleware_stack(scope, receive, send)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 776, in app
2024-09-09 15:04:43 | ERROR | stderr |   |     await route.handle(scope, receive, send)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 297, in handle
2024-09-09 15:04:43 | ERROR | stderr |   |     await self.app(scope, receive, send)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 77, in app
2024-09-09 15:04:43 | ERROR | stderr |   |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
2024-09-09 15:04:43 | ERROR | stderr |   |     raise exc
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
2024-09-09 15:04:43 | ERROR | stderr |   |     await app(scope, receive, sender)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/starlette/routing.py", line 75, in app
2024-09-09 15:04:43 | ERROR | stderr |   |     await response(scope, receive, send)
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 270, in __call__
2024-09-09 15:04:43 | ERROR | stderr |   |     async with anyio.create_task_group() as task_group:
2024-09-09 15:04:43 | ERROR | stderr |   |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 680, in __aexit__
2024-09-09 15:04:43 | ERROR | stderr |   |     raise BaseExceptionGroup(
2024-09-09 15:04:43 | ERROR | stderr |   | exceptiongroup.ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
2024-09-09 15:04:43 | ERROR | stderr |   +-+---------------- 1 ----------------
2024-09-09 15:04:43 | ERROR | stderr |     | Traceback (most recent call last):
2024-09-09 15:04:43 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 273, in wrap
2024-09-09 15:04:43 | ERROR | stderr |     |     await func()
2024-09-09 15:04:43 | ERROR | stderr |     |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/site-packages/sse_starlette/sse.py", line 253, in stream_response
2024-09-09 15:04:43 | ERROR | stderr |     |     async for data in self.body_iterator:
2024-09-09 15:04:43 | ERROR | stderr |     |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/server/chat/knowledge_base_chat.py", line 120, in knowledge_base_chat_iterator
2024-09-09 15:04:43 | ERROR | stderr |     |     reranker_model = LangchainReranker(top_n=RERANKER_TOP_K,
2024-09-09 15:04:43 | ERROR | stderr |     | NameError: name 'RERANKER_TOP_K' is not defined. Did you mean: 'RERANKER_MODEL'?
2024-09-09 15:04:43 | ERROR | stderr |     +------------------------------------
2024-09-09 15:05:01 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 15:05:01 | INFO | stdout | [32mINFO[0m:     127.0.0.1:55052 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:05:09 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 15:05:09 | INFO | stdout | [32mINFO[0m:     127.0.0.1:55060 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:05:46 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 15:05:46 | INFO | stdout | [32mINFO[0m:     127.0.0.1:58618 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:05:54 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 15:05:54 | INFO | stdout | [32mINFO[0m:     127.0.0.1:43080 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:06:31 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 15:06:31 | INFO | stdout | [32mINFO[0m:     127.0.0.1:43686 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:06:39 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 15:06:39 | INFO | stdout | [32mINFO[0m:     127.0.0.1:43690 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:06:42 | WARNING | controller | Sending SIGKILL to {'zhipu-api': <Process name='api_worker - zhipu-api (3764)' pid=3764 parent=3628 started daemon>}
2024-09-09 15:06:42 | WARNING | controller | Sending SIGKILL to {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (3763)' pid=3763 parent=3628 started daemon>}
2024-09-09 15:06:42 | WARNING | controller | Sending SIGKILL to <Process name='controller (3718)' pid=3718 parent=3628 started daemon>
2024-09-09 15:06:42 | WARNING | controller | Sending SIGKILL to <Process name='openai_api (3762)' pid=3762 parent=3628 started daemon>
2024-09-09 15:06:42 | WARNING | controller | Sending SIGKILL to <Process name='API Server (3907)' pid=3907 parent=3628 started daemon>
2024-09-09 15:06:42 | INFO | controller | Process status: {'zhipu-api': <Process name='api_worker - zhipu-api (3764)' pid=3764 parent=3628 started daemon>}
2024-09-09 15:06:42 | INFO | controller | Process status: {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (3763)' pid=3763 parent=3628 started daemon>}
2024-09-09 15:06:42 | INFO | controller | Process status: <Process name='controller (3718)' pid=3718 parent=3628 started daemon>
2024-09-09 15:06:42 | INFO | controller | Process status: <Process name='openai_api (3762)' pid=3762 parent=3628 started daemon>
2024-09-09 15:06:42 | INFO | controller | Process status: <Process name='API Server (3907)' pid=3907 parent=3628 started daemon>
2024-09-09 15:06:42 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 15:06:42 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 584, in <module>
2024-09-09 15:06:42 | ERROR | stderr |     loop.run_until_complete(start_main_server())
2024-09-09 15:06:42 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 495, in start_main_server
2024-09-09 15:06:42 | ERROR | stderr |     cmd = queue.get()
2024-09-09 15:06:42 | ERROR | stderr |   File "<string>", line 2, in get
2024-09-09 15:06:42 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 818, in _callmethod
2024-09-09 15:06:42 | ERROR | stderr |     kind, result = conn.recv()
2024-09-09 15:06:42 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 255, in recv
2024-09-09 15:06:42 | ERROR | stderr |     buf = self._recv_bytes()
2024-09-09 15:06:42 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 419, in _recv_bytes
2024-09-09 15:06:42 | ERROR | stderr |     buf = self._recv(4)
2024-09-09 15:06:42 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 384, in _recv
2024-09-09 15:06:42 | ERROR | stderr |     chunk = read(handle, remaining)
2024-09-09 15:06:42 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 15:06:42 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 15:06:42 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 15:06:43 | ERROR | stderr | Exception ignored in atexit callback: <function _exit_function at 0x7fee6a7b2b90>
2024-09-09 15:06:43 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 15:06:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 334, in _exit_function
2024-09-09 15:06:43 | ERROR | stderr |     _run_finalizers(0)
2024-09-09 15:06:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 300, in _run_finalizers
2024-09-09 15:06:43 | ERROR | stderr |     finalizer()
2024-09-09 15:06:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 224, in __call__
2024-09-09 15:06:43 | ERROR | stderr |     res = self._callback(*self._args, **self._kwargs)
2024-09-09 15:06:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 674, in _finalize_manager
2024-09-09 15:06:43 | ERROR | stderr |     process.join(timeout=1.0)
2024-09-09 15:06:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/process.py", line 149, in join
2024-09-09 15:06:43 | ERROR | stderr |     res = self._popen.wait(timeout)
2024-09-09 15:06:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/popen_fork.py", line 40, in wait
2024-09-09 15:06:43 | ERROR | stderr |     if not wait([self.sentinel], timeout):
2024-09-09 15:06:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 936, in wait
2024-09-09 15:06:43 | ERROR | stderr |     ready = selector.select(timeout)
2024-09-09 15:06:43 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/selectors.py", line 416, in select
2024-09-09 15:06:43 | ERROR | stderr |     fd_event_list = self._selector.poll(timeout)
2024-09-09 15:06:43 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 15:06:43 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 15:06:43 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 15:06:45 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:06:55 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:07:04 | INFO | controller | Ê≠£Âú®ÂêØÂä®ÊúçÂä°Ôºö
2024-09-09 15:07:04 | INFO | controller | Â¶ÇÈúÄÊü•Áúã ÊúçÂä°Êó•Âøó Êó•ÂøóÔºåËØ∑ÂâçÂæÄ /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:07:05 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:07:12 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m4123[0m]
2024-09-09 15:07:12 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:07:12 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:07:12 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20001[0m (Press CTRL+C to quit)
2024-09-09 15:07:12 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:07:12 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:07:12 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:07:19 | ERROR | stderr | Loading checkpoint shards:   0%|                                                                                              | 0/7 [00:00<?, ?it/s]
2024-09-09 15:07:19 | ERROR | stderr | Loading checkpoint shards:  14%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé                                                                         | 1/7 [00:00<00:02,  2.24it/s]
2024-09-09 15:07:20 | ERROR | stderr | Loading checkpoint shards:  29%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå                                                             | 2/7 [00:00<00:02,  2.23it/s]
2024-09-09 15:07:20 | ERROR | stderr | Loading checkpoint shards:  43%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä                                                 | 3/7 [00:01<00:01,  2.18it/s]
2024-09-09 15:07:21 | ERROR | stderr | Loading checkpoint shards:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè                                    | 4/7 [00:01<00:01,  2.20it/s]
2024-09-09 15:07:21 | ERROR | stderr | Loading checkpoint shards:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç                        | 5/7 [00:02<00:00,  2.15it/s]
2024-09-09 15:07:21 | INFO | controller | Register a new worker: http://127.0.0.1:21001
2024-09-09 15:07:21 | INFO | controller | Register done: http://127.0.0.1:21001, {'model_names': ['zhipu-api'], 'speed': 1, 'queue_length': 0}
2024-09-09 15:07:21 | INFO | stdout | [32mINFO[0m:     127.0.0.1:40554 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:07:21 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m4168[0m]
2024-09-09 15:07:21 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:07:21 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:07:21 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20000[0m (Press CTRL+C to quit)
2024-09-09 15:07:22 | ERROR | stderr | Loading checkpoint shards:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã            | 6/7 [00:02<00:00,  2.14it/s]
2024-09-09 15:07:22 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:03<00:00,  2.38it/s]
2024-09-09 15:07:22 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:03<00:00,  2.26it/s]
2024-09-09 15:07:22 | ERROR | stderr | 
2024-09-09 15:07:24 | INFO | controller | Register a new worker: http://127.0.0.1:20002
2024-09-09 15:07:24 | INFO | controller | Register done: http://127.0.0.1:20002, {'model_names': ['chatglm3-6b'], 'speed': 1, 'queue_length': 0}
2024-09-09 15:07:24 | INFO | stdout | [32mINFO[0m:     127.0.0.1:40566 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:07:24 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m4169[0m]
2024-09-09 15:07:24 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:07:24 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:07:24 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20002[0m (Press CTRL+C to quit)
2024-09-09 15:07:25 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:07:34 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m4316[0m]
2024-09-09 15:07:34 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:07:34 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:07:34 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:6006[0m (Press CTRL+C to quit)
2024-09-09 15:07:46 | INFO | stdout | 2024-09-09 15:07:46,982 INFO sqlalchemy.engine.Engine SELECT DATABASE()
2024-09-09 15:07:46 | INFO | stdout | 2024-09-09 15:07:46,982 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:07:46 | INFO | stdout | 2024-09-09 15:07:46,986 INFO sqlalchemy.engine.Engine SELECT @@sql_mode
2024-09-09 15:07:46 | INFO | stdout | 2024-09-09 15:07:46,987 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:07:46 | INFO | stdout | 2024-09-09 15:07:46,989 INFO sqlalchemy.engine.Engine SELECT @@lower_case_table_names
2024-09-09 15:07:46 | INFO | stdout | 2024-09-09 15:07:46,989 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:07:46 | INFO | stdout | 2024-09-09 15:07:46,993 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,033 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:07:47 | INFO | stdout | FROM knowledge_base
2024-09-09 15:07:47 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,033 INFO sqlalchemy.engine.Engine [generated in 0.00110s] ('private',)
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,037 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:07:47 | INFO | stdout | [32mINFO[0m:     127.0.0.1:35522 - "[1mPOST /api/chat/knowledge_base_chat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,056 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,060 INFO sqlalchemy.engine.Engine SELECT conversation.id AS conversation_id, conversation.user_id AS conversation_user_id, conversation.name AS conversation_name, conversation.chat_type AS conversation_chat_type, conversation.create_time AS conversation_create_time
2024-09-09 15:07:47 | INFO | stdout | FROM conversation
2024-09-09 15:07:47 | INFO | stdout | WHERE conversation.id = %s
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,061 INFO sqlalchemy.engine.Engine [generated in 0.00084s] ('84d11b49-848a-4a5c-894c-92e16e2e29d7',)
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,064 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,068 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,072 INFO sqlalchemy.engine.Engine INSERT INTO message (id, conversation_id, chat_type, query, response, meta_data, feedback_score, feedback_reason, create_time) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, now())
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,073 INFO sqlalchemy.engine.Engine [generated in 0.00089s] ('33072025-6247-447e-88ab-ad7dc8c6738d', '84d11b49-848a-4a5c-894c-92e16e2e29d7', 'default', '‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù', '', '{}', -1, '')
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,076 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,117 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,118 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:07:47 | INFO | stdout | FROM knowledge_base
2024-09-09 15:07:47 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,118 INFO sqlalchemy.engine.Engine [cached since 0.08595s ago] ('private',)
2024-09-09 15:07:47 | INFO | stdout | 2024-09-09 15:07:47,120 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:07:48 | INFO | stdout | ÊàëÁé∞Âú®ËøõÂÖ•Âà∞KBFaissPool ‰∏≠Âï¶  ÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅ
2024-09-09 15:07:48 | INFO | stdout | 2024-09-09 15:07:48,428 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:07:48 | INFO | stdout | 2024-09-09 15:07:48,429 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:07:48 | INFO | stdout | FROM knowledge_base
2024-09-09 15:07:48 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:07:48 | INFO | stdout | 2024-09-09 15:07:48,430 INFO sqlalchemy.engine.Engine [cached since 1.397s ago] ('private',)
2024-09-09 15:07:48 | INFO | stdout | 2024-09-09 15:07:48,433 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:07:48 | INFO | stdout | ËøôÊòØÊü•ËØ¢Âà∞ÁöÑload_kb_embeddingsÁöÑÂèÇÊï∞Ôºö{'kb_name': 'private', 'kb_info': 'private', 'vs_type': 'faiss', 'embed_model': 'bge-large-zh-v1.5', 'file_count': 2, 'create_time': datetime.datetime(2024, 9, 3, 20, 21, 34)}
2024-09-09 15:07:48 | INFO | stdout | query==================
2024-09-09 15:07:48 | INFO | stdout | ‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù
2024-09-09 15:07:48 | INFO | stdout | docs====================
2024-09-09 15:07:48 | INFO | stdout | [(Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '0f6bebe3-003c-4eff-9e71-b2abed0f8427'}, page_content='1.GLMÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªüËß£Èáä\n\nÊó∂Ëá≥‰ªäÊó•ÔºåÂ§öËßíËâ≤ÂØπËØùÂü∫Êú¨‰∏äÂ∑≤ÁªèÊàê‰∫ÜÈ°∂Â∞ñÂ§ßÊ®°ÂûãÁöÑÊ†áÈÖç„ÄÇÊ≠£ÊòØÂü∫‰∫éÂ§öËßíËâ≤ÂØπËØùËøô‰∏ÄÂü∫Á°ÄÊäÄÊúØÊû∂ÊûÑÔºåÂ§ß Ê®°ÂûãÊâçËÉΩÈùûÂ∏∏ÁÅµÊ¥ªÁöÑÂÆûÁé∞ÂêÑÁ±ªÂØπËØùÈúÄÊ±ÇÔºåÁîöËá≥Â§öËßíËâ≤ÂØπËØù‰πüÊòØÊõ¥È´òÊïàÁöÑÂÆûÁé∞Function callingÁöÑÂü∫Á°ÄÔºåËÄåÂêéËÄÖ ÂàôÊòØÊï¥‰∏™AgentÂºÄÂèëÁöÑÂü∫Áü≥„ÄÇ'), 0.4692958), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '02434c50-3afc-46f3-a5f5-2052485e3d79'}, page_content='Âú®‰∏ä‰∏ÄÂ∞èËäÇ‰∏≠ÔºåÊàë‰ª¨Â∑≤ÁªèÈ°∫Âà©ÂÆåÊàêÊô∫Ë∞±AIË¥¶Âè∑Ê≥®ÂÜåÔºåÂπ∂Ëé∑ÂèñGLMÊ®°ÂûãAPI-KEYÔºåÂêåÊó∂ÂÆåÊàê‰∫ÜÊú¨Âú∞Ë∞ÉÁî®Êµã ËØï„ÄÇÊú¨ËäÇÊàë‰ª¨Â∞ÜÂºÄÂßãÁùÄÊâã‰ΩøÁî®GLM-4Ê®°ÂûãÔºåÂπ∂ËØ¶ÁªÜ‰ªãÁªçGLM-4Ë∞ÉÁî®ÂáΩÊï∞ÂèÇÊï∞ÂèäÊ®°ÂûãÁöÑÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªü„ÄÇ'), 0.7292065), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': 'bfda97f8-c748-4f7c-9af5-3f8a5e2d0464'}, page_content="4. Âü∫‰∫éGLM4ÂÆûÁé∞‰∏éÁî®Êà∑ÁöÑÂ§öËΩÆÂØπËØù\n\ndef chat_once(first_prompts,message):\n\ntry:\n\nresponse = client.chat.completions.create(model = 'glm-4'\n\n,messages = messages)"), 0.7523923)]
2024-09-09 15:07:51 | ERROR | stderr | Batches:   0%|                                                                                                                | 0/1 [00:00<?, ?it/s]
2024-09-09 15:07:52 | ERROR | stderr | Batches: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 1/1 [00:00<00:00,  1.88it/s]
2024-09-09 15:07:52 | ERROR | stderr | Batches: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 1/1 [00:00<00:00,  1.88it/s]
2024-09-09 15:07:52 | ERROR | stderr | 
2024-09-09 15:07:52 | INFO | stdout | [32mINFO[0m:     127.0.0.1:50700 - "[1mPOST /list_models HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:07:52 | INFO | controller | names: ['http://127.0.0.1:20002'], queue_lens: [0.0], ret: http://127.0.0.1:20002
2024-09-09 15:07:52 | INFO | stdout | [32mINFO[0m:     127.0.0.1:50708 - "[1mPOST /get_worker_address HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:07:52 | INFO | stdout | [32mINFO[0m:     127.0.0.1:34126 - "[1mPOST /worker_get_conv_template HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:07:52 | INFO | stdout | [32mINFO[0m:     127.0.0.1:34128 - "[1mPOST /model_details HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:07:52 | INFO | stdout | [32mINFO[0m:     127.0.0.1:34142 - "[1mPOST /count_token HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:07:52 | INFO | stdout | [32mINFO[0m:     127.0.0.1:43790 - "[1mPOST /v1/chat/completions HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:07:52 | INFO | stdout | [32mINFO[0m:     127.0.0.1:34152 - "[1mPOST /worker_generate_stream HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:07:55 | INFO | stdout | 2024-09-09 15:07:55,854 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:07:55 | INFO | stdout | 2024-09-09 15:07:55,860 INFO sqlalchemy.engine.Engine SELECT message.id, message.conversation_id, message.chat_type, message.query, message.response, message.meta_data, message.feedback_score, message.feedback_reason, message.create_time
2024-09-09 15:07:55 | INFO | stdout | FROM message
2024-09-09 15:07:55 | INFO | stdout | WHERE message.id = %s
2024-09-09 15:07:55 | INFO | stdout | 2024-09-09 15:07:55,861 INFO sqlalchemy.engine.Engine [generated in 0.00143s] ('33072025-6247-447e-88ab-ad7dc8c6738d',)
2024-09-09 15:07:55 | INFO | stdout | 2024-09-09 15:07:55,866 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:07:55 | INFO | stdout | 2024-09-09 15:07:55,871 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:07:55 | INFO | stdout | 2024-09-09 15:07:55,875 INFO sqlalchemy.engine.Engine UPDATE message SET response=%s WHERE message.id = %s
2024-09-09 15:07:55 | INFO | stdout | 2024-09-09 15:07:55,875 INFO sqlalchemy.engine.Engine [generated in 0.00075s] ('GLM4Â§öËßíËâ≤ÂØπËØùÊòØ‰∏ÄÁßçÂü∫‰∫é‰∫∫Â∑•Êô∫ËÉΩÂä©ÊâãÔºàclientÔºâÂÆûÁé∞ÁöÑÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªü„ÄÇÂú®Ëøô‰∏™Á≥ªÁªü‰∏≠ÔºåÂèØ‰ª•ÂàõÂª∫Â§ö‰∏™ËßíËâ≤ÔºàÂ¶ÇÁî®Êà∑„ÄÅÊú∫Âô®‰∫∫Á≠âÔºâÔºåÂπ∂ÈÄöËøáÂ§öËΩÆÂØπËØùËøõË°å‰∫§‰∫í„ÄÇGLM4Ê®°ÂûãÊòØËøô‰∏™Á≥ªÁªüÁöÑÊ†∏ÂøÉÔºåÂÆÉÂèØ‰ª•ÁÅµÊ¥ªÂú∞ÂÆûÁé∞ÂêÑÁßçÂØπËØùÈúÄÊ±Ç„ÄÇÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªüÂú®Êô∫ËÉΩÂä©ÊâãÂºÄÂèë‰∏≠Ëµ∑ÁùÄÈáçË¶Å‰ΩúÁî®ÔºåÂÆÉ‰∏ç‰ªÖÊòØÂÆûÁé∞Function callingÁöÑÂü∫Á°ÄÔºå‰πüÊòØÊï¥‰∏™AgentÂºÄÂèëÁöÑÂü∫Áü≥„ÄÇ', '33072025-6247-447e-88ab-ad7dc8c6738d')
2024-09-09 15:07:55 | INFO | stdout | 2024-09-09 15:07:55,878 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:08:06 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 15:08:06 | INFO | stdout | [32mINFO[0m:     127.0.0.1:35254 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:08:09 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 15:08:09 | INFO | stdout | [32mINFO[0m:     127.0.0.1:35262 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:08:11 | WARNING | controller | Sending SIGKILL to {'zhipu-api': <Process name='api_worker - zhipu-api (4170)' pid=4170 parent=4034 started daemon>}
2024-09-09 15:08:11 | WARNING | controller | Sending SIGKILL to {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (4169)' pid=4169 parent=4034 started daemon>}
2024-09-09 15:08:11 | WARNING | controller | Sending SIGKILL to <Process name='controller (4123)' pid=4123 parent=4034 started daemon>
2024-09-09 15:08:11 | WARNING | controller | Sending SIGKILL to <Process name='openai_api (4168)' pid=4168 parent=4034 started daemon>
2024-09-09 15:08:11 | WARNING | controller | Sending SIGKILL to <Process name='API Server (4316)' pid=4316 parent=4034 started daemon>
2024-09-09 15:08:11 | INFO | controller | Process status: {'zhipu-api': <Process name='api_worker - zhipu-api (4170)' pid=4170 parent=4034 started daemon>}
2024-09-09 15:08:11 | INFO | controller | Process status: {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (4169)' pid=4169 parent=4034 started daemon>}
2024-09-09 15:08:11 | INFO | controller | Process status: <Process name='controller (4123)' pid=4123 parent=4034 started daemon>
2024-09-09 15:08:11 | INFO | controller | Process status: <Process name='openai_api (4168)' pid=4168 parent=4034 started daemon>
2024-09-09 15:08:11 | INFO | controller | Process status: <Process name='API Server (4316)' pid=4316 parent=4034 started daemon>
2024-09-09 15:08:11 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 584, in <module>
2024-09-09 15:08:11 | ERROR | stderr |     loop.run_until_complete(start_main_server())
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 495, in start_main_server
2024-09-09 15:08:11 | ERROR | stderr |     cmd = queue.get()
2024-09-09 15:08:11 | ERROR | stderr |   File "<string>", line 2, in get
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 818, in _callmethod
2024-09-09 15:08:11 | ERROR | stderr |     kind, result = conn.recv()
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 255, in recv
2024-09-09 15:08:11 | ERROR | stderr |     buf = self._recv_bytes()
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 419, in _recv_bytes
2024-09-09 15:08:11 | ERROR | stderr |     buf = self._recv(4)
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 384, in _recv
2024-09-09 15:08:11 | ERROR | stderr |     chunk = read(handle, remaining)
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 15:08:11 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 15:08:11 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 15:08:11 | ERROR | stderr | Exception ignored in atexit callback: <function _exit_function at 0x7f49fcf36b90>
2024-09-09 15:08:11 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 334, in _exit_function
2024-09-09 15:08:11 | ERROR | stderr |     _run_finalizers(0)
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 300, in _run_finalizers
2024-09-09 15:08:11 | ERROR | stderr |     finalizer()
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 224, in __call__
2024-09-09 15:08:11 | ERROR | stderr |     res = self._callback(*self._args, **self._kwargs)
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 674, in _finalize_manager
2024-09-09 15:08:11 | ERROR | stderr |     process.join(timeout=1.0)
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/process.py", line 149, in join
2024-09-09 15:08:11 | ERROR | stderr |     res = self._popen.wait(timeout)
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/popen_fork.py", line 40, in wait
2024-09-09 15:08:11 | ERROR | stderr |     if not wait([self.sentinel], timeout):
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 936, in wait
2024-09-09 15:08:11 | ERROR | stderr |     ready = selector.select(timeout)
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/selectors.py", line 416, in select
2024-09-09 15:08:11 | ERROR | stderr |     fd_event_list = self._selector.poll(timeout)
2024-09-09 15:08:11 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 15:08:11 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 15:08:11 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 15:36:54 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:37:04 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:37:11 | INFO | controller | Ê≠£Âú®ÂêØÂä®ÊúçÂä°Ôºö
2024-09-09 15:37:11 | INFO | controller | Â¶ÇÈúÄÊü•Áúã ÊúçÂä°Êó•Âøó Êó•ÂøóÔºåËØ∑ÂâçÂæÄ /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:37:12 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:37:18 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m5007[0m]
2024-09-09 15:37:18 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:37:18 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:37:18 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20001[0m (Press CTRL+C to quit)
2024-09-09 15:37:19 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:37:19 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:37:19 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:37:26 | INFO | controller | Register a new worker: http://127.0.0.1:21001
2024-09-09 15:37:26 | INFO | controller | Register done: http://127.0.0.1:21001, {'model_names': ['zhipu-api'], 'speed': 1, 'queue_length': 0}
2024-09-09 15:37:26 | INFO | stdout | [32mINFO[0m:     127.0.0.1:55956 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:37:26 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m5051[0m]
2024-09-09 15:37:26 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:37:26 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:37:26 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20000[0m (Press CTRL+C to quit)
2024-09-09 15:37:29 | ERROR | stderr | Loading checkpoint shards:   0%|                                                                                              | 0/7 [00:00<?, ?it/s]
2024-09-09 15:37:29 | ERROR | stderr | Loading checkpoint shards:  14%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé                                                                         | 1/7 [00:00<00:02,  2.35it/s]
2024-09-09 15:37:30 | ERROR | stderr | Loading checkpoint shards:  29%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå                                                             | 2/7 [00:00<00:02,  2.34it/s]
2024-09-09 15:37:30 | ERROR | stderr | Loading checkpoint shards:  43%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä                                                 | 3/7 [00:01<00:01,  2.39it/s]
2024-09-09 15:37:31 | ERROR | stderr | Loading checkpoint shards:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè                                    | 4/7 [00:01<00:01,  2.36it/s]
2024-09-09 15:37:31 | ERROR | stderr | Loading checkpoint shards:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç                        | 5/7 [00:02<00:00,  2.37it/s]
2024-09-09 15:37:31 | ERROR | stderr | Loading checkpoint shards:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã            | 6/7 [00:02<00:00,  2.42it/s]
2024-09-09 15:37:32 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.67it/s]
2024-09-09 15:37:32 | ERROR | stderr | Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [00:02<00:00,  2.50it/s]
2024-09-09 15:37:32 | ERROR | stderr | 
2024-09-09 15:37:34 | INFO | controller | Register a new worker: http://127.0.0.1:20002
2024-09-09 15:37:34 | INFO | controller | Register done: http://127.0.0.1:20002, {'model_names': ['chatglm3-6b'], 'speed': 1, 'queue_length': 0}
2024-09-09 15:37:34 | INFO | stdout | [32mINFO[0m:     127.0.0.1:51378 - "[1mPOST /register_worker HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:37:34 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m5052[0m]
2024-09-09 15:37:34 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:37:34 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:37:34 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:20002[0m (Press CTRL+C to quit)
2024-09-09 15:37:34 | INFO | stdout | /root/autodl-tmp/hw-chat/hw-chat-0.3/logs
2024-09-09 15:37:41 | ERROR | stderr | [32mINFO[0m:     Started server process [[36m5196[0m]
2024-09-09 15:37:41 | ERROR | stderr | [32mINFO[0m:     Waiting for application startup.
2024-09-09 15:37:41 | ERROR | stderr | [32mINFO[0m:     Application startup complete.
2024-09-09 15:37:41 | ERROR | stderr | [32mINFO[0m:     Uvicorn running on [1mhttp://127.0.0.1:6006[0m (Press CTRL+C to quit)
2024-09-09 15:38:11 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 15:38:11 | INFO | stdout | [32mINFO[0m:     127.0.0.1:47256 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:38:19 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 15:38:19 | INFO | stdout | [32mINFO[0m:     127.0.0.1:47266 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,573 INFO sqlalchemy.engine.Engine SELECT DATABASE()
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,573 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,577 INFO sqlalchemy.engine.Engine SELECT @@sql_mode
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,577 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,579 INFO sqlalchemy.engine.Engine SELECT @@lower_case_table_names
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,580 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,584 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,623 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:38:22 | INFO | stdout | FROM knowledge_base
2024-09-09 15:38:22 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,624 INFO sqlalchemy.engine.Engine [generated in 0.00110s] ('private',)
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,628 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:38:22 | INFO | stdout | [32mINFO[0m:     127.0.0.1:53066 - "[1mPOST /api/chat/knowledge_base_chat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,647 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,650 INFO sqlalchemy.engine.Engine SELECT conversation.id AS conversation_id, conversation.user_id AS conversation_user_id, conversation.name AS conversation_name, conversation.chat_type AS conversation_chat_type, conversation.create_time AS conversation_create_time
2024-09-09 15:38:22 | INFO | stdout | FROM conversation
2024-09-09 15:38:22 | INFO | stdout | WHERE conversation.id = %s
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,651 INFO sqlalchemy.engine.Engine [generated in 0.00082s] ('84d11b49-848a-4a5c-894c-92e16e2e29d7',)
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,654 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,657 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,661 INFO sqlalchemy.engine.Engine INSERT INTO message (id, conversation_id, chat_type, query, response, meta_data, feedback_score, feedback_reason, create_time) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, now())
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,662 INFO sqlalchemy.engine.Engine [generated in 0.00088s] ('991d09d7-9cdf-480a-8eb8-28ea9a5cedaf', '84d11b49-848a-4a5c-894c-92e16e2e29d7', 'default', '‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù', '', '{}', -1, '')
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,665 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,706 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,707 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:38:22 | INFO | stdout | FROM knowledge_base
2024-09-09 15:38:22 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,707 INFO sqlalchemy.engine.Engine [cached since 0.08474s ago] ('private',)
2024-09-09 15:38:22 | INFO | stdout | 2024-09-09 15:38:22,710 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:38:23 | INFO | stdout | ÊàëÁé∞Âú®ËøõÂÖ•Âà∞KBFaissPool ‰∏≠Âï¶  ÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅÔºÅ
2024-09-09 15:38:23 | INFO | stdout | 2024-09-09 15:38:23,895 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:38:23 | INFO | stdout | 2024-09-09 15:38:23,896 INFO sqlalchemy.engine.Engine SELECT knowledge_base.id, knowledge_base.kb_name, knowledge_base.kb_info, knowledge_base.vs_type, knowledge_base.embed_model, knowledge_base.file_count, knowledge_base.create_time, knowledge_base.user_id
2024-09-09 15:38:23 | INFO | stdout | FROM knowledge_base
2024-09-09 15:38:23 | INFO | stdout | WHERE lower(knowledge_base.kb_name) LIKE lower(%s)
2024-09-09 15:38:23 | INFO | stdout | 2024-09-09 15:38:23,897 INFO sqlalchemy.engine.Engine [cached since 1.274s ago] ('private',)
2024-09-09 15:38:23 | INFO | stdout | 2024-09-09 15:38:23,900 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:38:23 | INFO | stdout | ËøôÊòØÊü•ËØ¢Âà∞ÁöÑload_kb_embeddingsÁöÑÂèÇÊï∞Ôºö{'kb_name': 'private', 'kb_info': 'private', 'vs_type': 'faiss', 'embed_model': 'bge-large-zh-v1.5', 'file_count': 2, 'create_time': datetime.datetime(2024, 9, 3, 20, 21, 34)}
2024-09-09 15:38:23 | INFO | stdout | query==================
2024-09-09 15:38:23 | INFO | stdout | ‰ªÄ‰πàÊòØGLM4Â§öËßíËâ≤ÂØπËØù
2024-09-09 15:38:23 | INFO | stdout | docs====================
2024-09-09 15:38:23 | INFO | stdout | [(Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '0f6bebe3-003c-4eff-9e71-b2abed0f8427'}, page_content='1.GLMÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªüËß£Èáä\n\nÊó∂Ëá≥‰ªäÊó•ÔºåÂ§öËßíËâ≤ÂØπËØùÂü∫Êú¨‰∏äÂ∑≤ÁªèÊàê‰∫ÜÈ°∂Â∞ñÂ§ßÊ®°ÂûãÁöÑÊ†áÈÖç„ÄÇÊ≠£ÊòØÂü∫‰∫éÂ§öËßíËâ≤ÂØπËØùËøô‰∏ÄÂü∫Á°ÄÊäÄÊúØÊû∂ÊûÑÔºåÂ§ß Ê®°ÂûãÊâçËÉΩÈùûÂ∏∏ÁÅµÊ¥ªÁöÑÂÆûÁé∞ÂêÑÁ±ªÂØπËØùÈúÄÊ±ÇÔºåÁîöËá≥Â§öËßíËâ≤ÂØπËØù‰πüÊòØÊõ¥È´òÊïàÁöÑÂÆûÁé∞Function callingÁöÑÂü∫Á°ÄÔºåËÄåÂêéËÄÖ ÂàôÊòØÊï¥‰∏™AgentÂºÄÂèëÁöÑÂü∫Áü≥„ÄÇ'), 0.4692958), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': '02434c50-3afc-46f3-a5f5-2052485e3d79'}, page_content='Âú®‰∏ä‰∏ÄÂ∞èËäÇ‰∏≠ÔºåÊàë‰ª¨Â∑≤ÁªèÈ°∫Âà©ÂÆåÊàêÊô∫Ë∞±AIË¥¶Âè∑Ê≥®ÂÜåÔºåÂπ∂Ëé∑ÂèñGLMÊ®°ÂûãAPI-KEYÔºåÂêåÊó∂ÂÆåÊàê‰∫ÜÊú¨Âú∞Ë∞ÉÁî®Êµã ËØï„ÄÇÊú¨ËäÇÊàë‰ª¨Â∞ÜÂºÄÂßãÁùÄÊâã‰ΩøÁî®GLM-4Ê®°ÂûãÔºåÂπ∂ËØ¶ÁªÜ‰ªãÁªçGLM-4Ë∞ÉÁî®ÂáΩÊï∞ÂèÇÊï∞ÂèäÊ®°ÂûãÁöÑÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªü„ÄÇ'), 0.7292065), (Document(metadata={'source': '/tmp/tmpt3dbuopy/file_data.txt', 'id': 'bfda97f8-c748-4f7c-9af5-3f8a5e2d0464'}, page_content="4. Âü∫‰∫éGLM4ÂÆûÁé∞‰∏éÁî®Êà∑ÁöÑÂ§öËΩÆÂØπËØù\n\ndef chat_once(first_prompts,message):\n\ntry:\n\nresponse = client.chat.completions.create(model = 'glm-4'\n\n,messages = messages)"), 0.7523923)]
2024-09-09 15:38:27 | ERROR | stderr | Batches:   0%|                                                                                                                | 0/1 [00:00<?, ?it/s]
2024-09-09 15:38:27 | ERROR | stderr | Batches: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 1/1 [00:00<00:00,  2.13it/s]
2024-09-09 15:38:27 | ERROR | stderr | Batches: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 1/1 [00:00<00:00,  2.13it/s]
2024-09-09 15:38:27 | ERROR | stderr | 
2024-09-09 15:38:27 | INFO | stdout | [32mINFO[0m:     127.0.0.1:55824 - "[1mPOST /list_models HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:38:27 | INFO | controller | names: ['http://127.0.0.1:20002'], queue_lens: [0.0], ret: http://127.0.0.1:20002
2024-09-09 15:38:27 | INFO | stdout | [32mINFO[0m:     127.0.0.1:55826 - "[1mPOST /get_worker_address HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:38:27 | INFO | stdout | [32mINFO[0m:     127.0.0.1:50290 - "[1mPOST /worker_get_conv_template HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:38:27 | INFO | stdout | [32mINFO[0m:     127.0.0.1:50292 - "[1mPOST /model_details HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:38:27 | INFO | stdout | [32mINFO[0m:     127.0.0.1:50306 - "[1mPOST /count_token HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:38:27 | INFO | stdout | [32mINFO[0m:     127.0.0.1:54928 - "[1mPOST /v1/chat/completions HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:38:27 | INFO | stdout | [32mINFO[0m:     127.0.0.1:50314 - "[1mPOST /worker_generate_stream HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:38:30 | INFO | stdout | 2024-09-09 15:38:30,419 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:38:30 | INFO | stdout | 2024-09-09 15:38:30,424 INFO sqlalchemy.engine.Engine SELECT message.id, message.conversation_id, message.chat_type, message.query, message.response, message.meta_data, message.feedback_score, message.feedback_reason, message.create_time
2024-09-09 15:38:30 | INFO | stdout | FROM message
2024-09-09 15:38:30 | INFO | stdout | WHERE message.id = %s
2024-09-09 15:38:30 | INFO | stdout | 2024-09-09 15:38:30,425 INFO sqlalchemy.engine.Engine [generated in 0.00119s] ('991d09d7-9cdf-480a-8eb8-28ea9a5cedaf',)
2024-09-09 15:38:30 | INFO | stdout | 2024-09-09 15:38:30,429 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:38:30 | INFO | stdout | 2024-09-09 15:38:30,433 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-09-09 15:38:30 | INFO | stdout | 2024-09-09 15:38:30,436 INFO sqlalchemy.engine.Engine UPDATE message SET response=%s WHERE message.id = %s
2024-09-09 15:38:30 | INFO | stdout | 2024-09-09 15:38:30,437 INFO sqlalchemy.engine.Engine [generated in 0.00073s] ('GLM4Â§öËßíËâ≤ÂØπËØùÊòØ‰∏ÄÁßçÂü∫‰∫éÂ§ßÂûãËØ≠Ë®ÄÊ®°ÂûãÔºàGLMÔºâÁöÑÂ§öËßíËâ≤ÂØπËØùÁ≥ªÁªü„ÄÇÈÄöËøáËØ•Á≥ªÁªüÔºåÂèØ‰ª•ÂÆûÁé∞‰∏çÂêåËßíËâ≤‰πãÈó¥ÁöÑËá™ÁÑ∂ËØ≠Ë®ÄÂØπËØù„ÄÇËøôÁßçÁ≥ªÁªüÂπøÊ≥õÂ∫îÁî®‰∫éÊô∫ËÉΩÂÆ¢Êúç„ÄÅËôöÊãüÂä©ÊâãÁ≠âÈ¢ÜÂüüÔºåËÉΩÂ§üÊèêÈ´òÁî®Êà∑‰ΩìÈ™åÔºåÈôç‰Ωé‰∫∫Â∑•ÊàêÊú¨„ÄÇGLM4Â§öËßíËâ≤ÂØπËØùÁ≥ªÁªüÂü∫‰∫éGLM-4Ê®°ÂûãÂÆûÁé∞ÔºåËÉΩÂ§üÁÅµÊ¥ªÂú∞Êª°Ë∂≥ÂêÑÁ±ªÂØπËØùÈúÄÊ±Ç„ÄÇ', '991d09d7-9cdf-480a-8eb8-28ea9a5cedaf')
2024-09-09 15:38:30 | INFO | stdout | 2024-09-09 15:38:30,440 INFO sqlalchemy.engine.Engine COMMIT
2024-09-09 15:38:56 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 15:38:56 | INFO | stdout | [32mINFO[0m:     127.0.0.1:42402 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:39:04 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 15:39:04 | INFO | stdout | [32mINFO[0m:     127.0.0.1:53586 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:39:41 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 15:39:41 | INFO | stdout | [32mINFO[0m:     127.0.0.1:40998 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:39:49 | INFO | controller | Receive heart beat. http://127.0.0.1:20002
2024-09-09 15:39:49 | INFO | stdout | [32mINFO[0m:     127.0.0.1:41000 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:40:27 | INFO | controller | Receive heart beat. http://127.0.0.1:21001
2024-09-09 15:40:27 | INFO | stdout | [32mINFO[0m:     127.0.0.1:55384 - "[1mPOST /receive_heart_beat HTTP/1.1[0m" [32m200 OK[0m
2024-09-09 15:40:27 | WARNING | controller | Sending SIGKILL to {'zhipu-api': <Process name='api_worker - zhipu-api (5053)' pid=5053 parent=4917 started daemon>}
2024-09-09 15:40:27 | WARNING | controller | Sending SIGKILL to {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (5052)' pid=5052 parent=4917 started daemon>}
2024-09-09 15:40:27 | WARNING | controller | Sending SIGKILL to <Process name='controller (5007)' pid=5007 parent=4917 started daemon>
2024-09-09 15:40:27 | WARNING | controller | Sending SIGKILL to <Process name='openai_api (5051)' pid=5051 parent=4917 started daemon>
2024-09-09 15:40:27 | WARNING | controller | Sending SIGKILL to <Process name='API Server (5196)' pid=5196 parent=4917 started daemon>
2024-09-09 15:40:27 | INFO | controller | Process status: {'zhipu-api': <Process name='api_worker - zhipu-api (5053)' pid=5053 parent=4917 started daemon>}
2024-09-09 15:40:27 | INFO | controller | Process status: {'chatglm3-6b': <Process name='model_worker - chatglm3-6b (5052)' pid=5052 parent=4917 started daemon>}
2024-09-09 15:40:27 | INFO | controller | Process status: <Process name='controller (5007)' pid=5007 parent=4917 started daemon>
2024-09-09 15:40:27 | INFO | controller | Process status: <Process name='openai_api (5051)' pid=5051 parent=4917 started daemon>
2024-09-09 15:40:27 | INFO | controller | Process status: <Process name='API Server (5196)' pid=5196 parent=4917 started daemon>
2024-09-09 15:40:27 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 584, in <module>
2024-09-09 15:40:27 | ERROR | stderr |     loop.run_until_complete(start_main_server())
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 495, in start_main_server
2024-09-09 15:40:27 | ERROR | stderr |     cmd = queue.get()
2024-09-09 15:40:27 | ERROR | stderr |   File "<string>", line 2, in get
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 818, in _callmethod
2024-09-09 15:40:27 | ERROR | stderr |     kind, result = conn.recv()
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 255, in recv
2024-09-09 15:40:27 | ERROR | stderr |     buf = self._recv_bytes()
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 419, in _recv_bytes
2024-09-09 15:40:27 | ERROR | stderr |     buf = self._recv(4)
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 384, in _recv
2024-09-09 15:40:27 | ERROR | stderr |     chunk = read(handle, remaining)
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 15:40:27 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 15:40:27 | ERROR | stderr | KeyboardInterrupt: SIGINT received
2024-09-09 15:40:27 | ERROR | stderr | Exception ignored in atexit callback: <function _exit_function at 0x7f05b9922b90>
2024-09-09 15:40:27 | ERROR | stderr | Traceback (most recent call last):
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 334, in _exit_function
2024-09-09 15:40:27 | ERROR | stderr |     _run_finalizers(0)
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 300, in _run_finalizers
2024-09-09 15:40:27 | ERROR | stderr |     finalizer()
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/util.py", line 224, in __call__
2024-09-09 15:40:27 | ERROR | stderr |     res = self._callback(*self._args, **self._kwargs)
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/managers.py", line 674, in _finalize_manager
2024-09-09 15:40:27 | ERROR | stderr |     process.join(timeout=1.0)
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/process.py", line 149, in join
2024-09-09 15:40:27 | ERROR | stderr |     res = self._popen.wait(timeout)
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/popen_fork.py", line 40, in wait
2024-09-09 15:40:27 | ERROR | stderr |     if not wait([self.sentinel], timeout):
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/multiprocessing/connection.py", line 936, in wait
2024-09-09 15:40:27 | ERROR | stderr |     ready = selector.select(timeout)
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/miniconda3/envs/hw-chat-0.1/lib/python3.10/selectors.py", line 416, in select
2024-09-09 15:40:27 | ERROR | stderr |     fd_event_list = self._selector.poll(timeout)
2024-09-09 15:40:27 | ERROR | stderr |   File "/root/autodl-tmp/hw-chat/hw-chat-0.3/startup.py", line 368, in f
2024-09-09 15:40:27 | ERROR | stderr |     raise KeyboardInterrupt(f"{signalname} received")
2024-09-09 15:40:27 | ERROR | stderr | KeyboardInterrupt: SIGINT received
